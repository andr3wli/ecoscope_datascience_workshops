<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Intermediate R programming | ECOSCOPE: Data Science Workshops</title>
  <meta name="description" content="UBC ECOSCOPE workshop materials in the form of a bookdown book." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Intermediate R programming | ECOSCOPE: Data Science Workshops" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="UBC ECOSCOPE workshop materials in the form of a bookdown book." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Intermediate R programming | ECOSCOPE: Data Science Workshops" />
  
  <meta name="twitter:description" content="UBC ECOSCOPE workshop materials in the form of a bookdown book." />
  

<meta name="author" content="Andrew Li" />
<meta name="author" content="Stephan Koenig" />


<meta name="date" content="2021-08-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistical-models-in-r-1.html"/>

<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ECOSCOPE: Data Science Workshops</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> ECOSCOPE</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.1</b> Schedule</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workshops"><i class="fa fa-check"></i><b>1.2</b> Workshops</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#introduction-to-r-and-r-studio"><i class="fa fa-check"></i><b>1.2.1</b> Introduction to R and R Studio</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#introduction-to-the-tidyverse"><i class="fa fa-check"></i><b>1.2.2</b> Introduction to the tidyverse</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#reproducible-research"><i class="fa fa-check"></i><b>1.2.3</b> Reproducible research</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#statistical-models-in-r"><i class="fa fa-check"></i><b>1.2.4</b> Statistical models in R</a></li>
<li class="chapter" data-level="1.2.5" data-path="index.html"><a href="index.html#intermediate-r-programming"><i class="fa fa-check"></i><b>1.2.5</b> Intermediate R programming</a></li>
<li class="chapter" data-level="1.2.6" data-path="index.html"><a href="index.html#beyond-ggplot2"><i class="fa fa-check"></i><b>1.2.6</b> Beyond ggplot2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>2</b> Introduction to R and RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#what-is-r"><i class="fa fa-check"></i><b>2.1.1</b> What is R?</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#using-r-in-your-own-computer"><i class="fa fa-check"></i><b>2.2</b> Using R in your own computer</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#what-is-rstudio"><i class="fa fa-check"></i><b>2.2.1</b> What is RStudio?</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#the-r-console"><i class="fa fa-check"></i><b>2.2.2</b> The R console</a></li>
<li class="chapter" data-level="2.2.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#the-r-environment"><i class="fa fa-check"></i><b>2.2.3</b> The R Environment</a></li>
<li class="chapter" data-level="2.2.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#scripts"><i class="fa fa-check"></i><b>2.2.4</b> Scripts</a></li>
<li class="chapter" data-level="2.2.5" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.2.5</b> Installing and loading packages</a></li>
<li class="chapter" data-level="2.2.6" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#paths-and-working-directory"><i class="fa fa-check"></i><b>2.2.6</b> Paths and working directory</a></li>
<li class="chapter" data-level="2.2.7" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#rstudio-projects"><i class="fa fa-check"></i><b>2.2.7</b> RStudio projects</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#r-as-a-calculator"><i class="fa fa-check"></i><b>2.3</b> R as a calculator</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#assigning-variables"><i class="fa fa-check"></i><b>2.4</b> Assigning variables</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#comments"><i class="fa fa-check"></i><b>2.4.1</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#functions"><i class="fa fa-check"></i><b>2.5</b> Functions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#the-most-helpful-function-of-all-the-help-function"><i class="fa fa-check"></i><b>2.5.1</b> The most helpful function of all: the ‘help’ function</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#data-types"><i class="fa fa-check"></i><b>2.6</b> Data types</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#exercises"><i class="fa fa-check"></i><b>2.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#structures"><i class="fa fa-check"></i><b>2.7</b> Structures</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#vectors"><i class="fa fa-check"></i><b>2.7.1</b> Vectors</a></li>
<li class="chapter" data-level="2.7.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#apply-functions-over-vectors"><i class="fa fa-check"></i><b>2.7.2</b> Apply functions over vectors</a></li>
<li class="chapter" data-level="2.7.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#arithmetic-operations-on-vectors"><i class="fa fa-check"></i><b>2.7.3</b> Arithmetic operations on vectors</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#data-frames"><i class="fa fa-check"></i><b>2.8</b> Data frames</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#example-data-frame"><i class="fa fa-check"></i><b>2.8.1</b> Example data frame</a></li>
<li class="chapter" data-level="2.8.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#importing-the-data-frame"><i class="fa fa-check"></i><b>2.8.2</b> Importing the data frame</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#quick-plots"><i class="fa fa-check"></i><b>2.9</b> Quick plots</a></li>
<li class="chapter" data-level="2.10" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#accessing-and-subsetting-data"><i class="fa fa-check"></i><b>2.10</b> Accessing and subsetting data</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#acessing-vector-elements"><i class="fa fa-check"></i><b>2.10.1</b> Acessing vector elements</a></li>
<li class="chapter" data-level="2.10.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#accessing-data-frame-elements"><i class="fa fa-check"></i><b>2.10.2</b> Accessing data frame elements</a></li>
<li class="chapter" data-level="2.10.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#subsetting-rows-according-to-condition"><i class="fa fa-check"></i><b>2.10.3</b> Subsetting rows according to condition</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#additional-exercises"><i class="fa fa-check"></i><b>2.11</b> Additional exercises</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#exercise-1-install-packages"><i class="fa fa-check"></i><b>2.11.1</b> Exercise 1: Install packages</a></li>
<li class="chapter" data-level="2.11.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#exercise-2-calculating-a-probability-density"><i class="fa fa-check"></i><b>2.11.2</b> Exercise 2: Calculating a probability density</a></li>
<li class="chapter" data-level="2.11.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#exercise-3-use-the-help-function-to-learn-how-to-flip-coins"><i class="fa fa-check"></i><b>2.11.3</b> Exercise 3: Use the help function to learn how to flip coins</a></li>
<li class="chapter" data-level="2.11.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#exercise-4-working-with-data"><i class="fa fa-check"></i><b>2.11.4</b> Exercise 4: Working with data</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#survey"><i class="fa fa-check"></i><b>2.12</b> Survey</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html"><i class="fa fa-check"></i><b>3</b> Introduction to the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#setup-intructions"><i class="fa fa-check"></i><b>3.1.1</b> Setup intructions</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#background"><i class="fa fa-check"></i><b>3.1.2</b> Background</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#data-description"><i class="fa fa-check"></i><b>3.2</b> Data description</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#getting-started"><i class="fa fa-check"></i><b>3.3</b> Getting Started</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#making-an-rstudio-project"><i class="fa fa-check"></i><b>3.3.1</b> Making an RStudio project</a></li>
<li class="chapter" data-level="3.3.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#installing-and-loading-packages-1"><i class="fa fa-check"></i><b>3.3.2</b> Installing and loading packages</a></li>
<li class="chapter" data-level="3.3.3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#downloading-the-data"><i class="fa fa-check"></i><b>3.3.3</b> Downloading the data</a></li>
<li class="chapter" data-level="3.3.4" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#loading-data-with-readr"><i class="fa fa-check"></i><b>3.3.4</b> Loading data with <code>readr</code></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#data-in-r"><i class="fa fa-check"></i><b>3.4</b> Data in R</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#basic-data-types-in-r"><i class="fa fa-check"></i><b>3.4.1</b> Basic data types in R</a></li>
<li class="chapter" data-level="3.4.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#basic-data-structures-in-r"><i class="fa fa-check"></i><b>3.4.2</b> Basic data structures in R</a></li>
<li class="chapter" data-level="3.4.3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#conditional-statements-and-logical-operators"><i class="fa fa-check"></i><b>3.4.3</b> Conditional statements and logical operators</a></li>
<li class="chapter" data-level="3.4.4" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#exercises-1"><i class="fa fa-check"></i><b>3.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#data-wrangling-with-dplyr"><i class="fa fa-check"></i><b>3.5</b> Data wrangling with <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#select"><i class="fa fa-check"></i><b>3.5.1</b> Select</a></li>
<li class="chapter" data-level="3.5.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#filter"><i class="fa fa-check"></i><b>3.5.2</b> Filter</a></li>
<li class="chapter" data-level="3.5.3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#rename"><i class="fa fa-check"></i><b>3.5.3</b> Rename</a></li>
<li class="chapter" data-level="3.5.4" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#arrange"><i class="fa fa-check"></i><b>3.5.4</b> Arrange</a></li>
<li class="chapter" data-level="3.5.5" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#mutate"><i class="fa fa-check"></i><b>3.5.5</b> Mutate</a></li>
<li class="chapter" data-level="3.5.6" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#piping-with"><i class="fa fa-check"></i><b>3.5.6</b> Piping with <code>%&gt;%</code></a></li>
<li class="chapter" data-level="3.5.7" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#group-by-and-summarise"><i class="fa fa-check"></i><b>3.5.7</b> Group by and Summarise</a></li>
<li class="chapter" data-level="3.5.8" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#wide-and-long-data---gather-and-spread"><i class="fa fa-check"></i><b>3.5.8</b> Wide and long data - gather and spread</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#graphics-with-ggplot2"><i class="fa fa-check"></i><b>3.6</b> Graphics with ggplot2</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#why-ggolot"><i class="fa fa-check"></i><b>3.6.1</b> Why ggolot?</a></li>
<li class="chapter" data-level="3.6.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#ggplot-building-blocks"><i class="fa fa-check"></i><b>3.6.2</b> ggplot building blocks</a></li>
<li class="chapter" data-level="3.6.3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#geom_point"><i class="fa fa-check"></i><b>3.6.3</b> geom_point</a></li>
<li class="chapter" data-level="3.6.4" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#geom_line"><i class="fa fa-check"></i><b>3.6.4</b> geom_line</a></li>
<li class="chapter" data-level="3.6.5" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#geom_histogram"><i class="fa fa-check"></i><b>3.6.5</b> geom_histogram</a></li>
<li class="chapter" data-level="3.6.6" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#geom_boxplot"><i class="fa fa-check"></i><b>3.6.6</b> geom_boxplot</a></li>
<li class="chapter" data-level="3.6.7" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#facet_wrap"><i class="fa fa-check"></i><b>3.6.7</b> facet_wrap</a></li>
<li class="chapter" data-level="3.6.8" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#labels"><i class="fa fa-check"></i><b>3.6.8</b> labels</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#fine-tuning-your-ggplots"><i class="fa fa-check"></i><b>3.7</b> Fine-tuning your ggplots</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#themes"><i class="fa fa-check"></i><b>3.7.1</b> Themes</a></li>
<li class="chapter" data-level="3.7.2" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#panel-1"><i class="fa fa-check"></i><b>3.7.2</b> Panel 1</a></li>
<li class="chapter" data-level="3.7.3" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#panel-2"><i class="fa fa-check"></i><b>3.7.3</b> Panel 2</a></li>
<li class="chapter" data-level="3.7.4" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#multi-panel-figues"><i class="fa fa-check"></i><b>3.7.4</b> Multi-panel figues</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#saving-ggplots"><i class="fa fa-check"></i><b>3.8</b> Saving ggplots</a></li>
<li class="chapter" data-level="3.9" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#additional-resources"><i class="fa fa-check"></i><b>3.9</b> Additional resources</a></li>
<li class="chapter" data-level="3.10" data-path="introduction-to-the-tidyverse-1.html"><a href="introduction-to-the-tidyverse-1.html#survey-1"><i class="fa fa-check"></i><b>3.10</b> Survey</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html"><i class="fa fa-check"></i><b>4</b> Reproducible research</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#prior-to-the-workshop"><i class="fa fa-check"></i><b>4.2</b> Prior to the workshop</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#setup-instructions"><i class="fa fa-check"></i><b>4.2.1</b> Setup instructions</a></li>
<li class="chapter" data-level="4.2.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#background-1"><i class="fa fa-check"></i><b>4.2.2</b> Background</a></li>
<li class="chapter" data-level="4.2.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#terminology"><i class="fa fa-check"></i><b>4.2.3</b> Terminology</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#why-reproducibility"><i class="fa fa-check"></i><b>4.3</b> Why reproducibility?</a></li>
<li class="chapter" data-level="4.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#r-projects"><i class="fa fa-check"></i><b>4.4</b> R projects</a></li>
<li class="chapter" data-level="4.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#r-scripts"><i class="fa fa-check"></i><b>4.5</b> R scripts</a></li>
<li class="chapter" data-level="4.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#modularize-by-task"><i class="fa fa-check"></i><b>4.6</b> Modularize by task</a></li>
<li class="chapter" data-level="4.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#use-make"><i class="fa fa-check"></i><b>4.7</b> Use <em>Make</em></a></li>
<li class="chapter" data-level="4.8" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#reproducible-r-environment-with-packrat"><i class="fa fa-check"></i><b>4.8</b> Reproducible R environment with <code>packrat</code></a></li>
<li class="chapter" data-level="4.9" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#documents-made-reproducible"><i class="fa fa-check"></i><b>4.9</b> Documents made reproducible</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#what-is-a-document-really"><i class="fa fa-check"></i><b>4.9.1</b> What is a document really?</a></li>
<li class="chapter" data-level="4.9.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#rmarkdown"><i class="fa fa-check"></i><b>4.9.2</b> Rmarkdown</a></li>
<li class="chapter" data-level="4.9.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#knitting"><i class="fa fa-check"></i><b>4.9.3</b> Knitting</a></li>
<li class="chapter" data-level="4.9.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#markdown-body"><i class="fa fa-check"></i><b>4.9.4</b> Markdown body</a></li>
<li class="chapter" data-level="4.9.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#static-documents"><i class="fa fa-check"></i><b>4.9.5</b> Static documents</a></li>
<li class="chapter" data-level="4.9.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#dynamic-documents"><i class="fa fa-check"></i><b>4.9.6</b> Dynamic documents</a></li>
<li class="chapter" data-level="4.9.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#slides-made-reproducible"><i class="fa fa-check"></i><b>4.9.7</b> Slides made reproducible</a></li>
<li class="chapter" data-level="4.9.8" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#rmd-in-your-workflow"><i class="fa fa-check"></i><b>4.9.8</b> Rmd in your workflow</a></li>
<li class="chapter" data-level="4.9.9" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#publish-with-rpubs.com"><i class="fa fa-check"></i><b>4.9.9</b> Publish with Rpubs.com</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#git"><i class="fa fa-check"></i><b>4.10</b> Git</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#what-is-version-control"><i class="fa fa-check"></i><b>4.10.1</b> What is version control?</a></li>
<li class="chapter" data-level="4.10.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#why-git"><i class="fa fa-check"></i><b>4.10.2</b> Why Git?</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#git-on-your-computer"><i class="fa fa-check"></i><b>4.11</b> Git on your computer</a>
<ul>
<li class="chapter" data-level="4.11.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#initialize-a-repo-git-init"><i class="fa fa-check"></i><b>4.11.1</b> Initialize a repo (<code>git init</code>)</a></li>
<li class="chapter" data-level="4.11.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#add-files-git-add"><i class="fa fa-check"></i><b>4.11.2</b> Add files (<code>git add</code>)</a></li>
<li class="chapter" data-level="4.11.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#git-staging-area-index"><i class="fa fa-check"></i><b>4.11.3</b> Git staging area (index)</a></li>
<li class="chapter" data-level="4.11.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#commit-changes-git-commit"><i class="fa fa-check"></i><b>4.11.4</b> Commit changes (<code>git commit</code>)</a></li>
<li class="chapter" data-level="4.11.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#comapre-versions-git-status-and-diff"><i class="fa fa-check"></i><b>4.11.5</b> Comapre versions (<code>git status</code> and <code>diff</code>)</a></li>
<li class="chapter" data-level="4.11.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#past-commits-git-log-and-show"><i class="fa fa-check"></i><b>4.11.6</b> Past commits (<code>git log</code> and <code>show</code>)</a></li>
<li class="chapter" data-level="4.11.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#branches-git-checkout--b"><i class="fa fa-check"></i><b>4.11.7</b> Branches (<code>git checkout -b</code>)</a></li>
<li class="chapter" data-level="4.11.8" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#merge-conflicts-git-merge"><i class="fa fa-check"></i><b>4.11.8</b> Merge conflicts (<code>git merge</code>)</a></li>
<li class="chapter" data-level="4.11.9" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#summary-of-git"><i class="fa fa-check"></i><b>4.11.9</b> Summary of Git</a></li>
</ul></li>
<li class="chapter" data-level="4.12" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#collaborate-with-github"><i class="fa fa-check"></i><b>4.12</b> Collaborate with GitHub</a>
<ul>
<li class="chapter" data-level="4.12.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#configure-your-computer-git-config"><i class="fa fa-check"></i><b>4.12.1</b> Configure your computer (<code>git config</code>)</a></li>
<li class="chapter" data-level="4.12.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#make-an-online-repo"><i class="fa fa-check"></i><b>4.12.2</b> Make an online repo</a></li>
<li class="chapter" data-level="4.12.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#link-local-and-online-repo-git-remote"><i class="fa fa-check"></i><b>4.12.3</b> Link local and online repo (<code>git remote</code>)</a></li>
<li class="chapter" data-level="4.12.4" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#update-an-online-repo-git-push"><i class="fa fa-check"></i><b>4.12.4</b> Update an online repo (<code>git push</code>)</a></li>
<li class="chapter" data-level="4.12.5" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#copy-an-online-repo-git-clone"><i class="fa fa-check"></i><b>4.12.5</b> Copy an online repo (<code>git clone</code>)</a></li>
<li class="chapter" data-level="4.12.6" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#update-from-online-repo-git-fetch-and-pull"><i class="fa fa-check"></i><b>4.12.6</b> Update from online repo (<code>git fetch</code> and <code>pull</code>)</a></li>
<li class="chapter" data-level="4.12.7" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#github-gui"><i class="fa fa-check"></i><b>4.12.7</b> GitHub GUI</a></li>
<li class="chapter" data-level="4.12.8" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#git-in-rstudio"><i class="fa fa-check"></i><b>4.12.8</b> Git in RStudio</a></li>
</ul></li>
<li class="chapter" data-level="4.13" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#additional-resources-1"><i class="fa fa-check"></i><b>4.13</b> Additional resources</a>
<ul>
<li class="chapter" data-level="4.13.1" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#reproducible-research-2"><i class="fa fa-check"></i><b>4.13.1</b> Reproducible research</a></li>
<li class="chapter" data-level="4.13.2" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#rrstudio"><i class="fa fa-check"></i><b>4.13.2</b> R/RStudio</a></li>
<li class="chapter" data-level="4.13.3" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#gitgithub"><i class="fa fa-check"></i><b>4.13.3</b> Git/GitHub</a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="reproducible-research-1.html"><a href="reproducible-research-1.html#survey-2"><i class="fa fa-check"></i><b>4.14</b> Survey</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html"><i class="fa fa-check"></i><b>5</b> Statistical models in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#setup-instructions-1"><i class="fa fa-check"></i><b>5.1.1</b> Setup instructions</a></li>
<li class="chapter" data-level="5.1.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#data-description-1"><i class="fa fa-check"></i><b>5.1.2</b> Data description</a></li>
<li class="chapter" data-level="5.1.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#making-an-rstudio-project-1"><i class="fa fa-check"></i><b>5.1.3</b> Making an RStudio project</a></li>
<li class="chapter" data-level="5.1.4" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#installing-and-loading-packages-2"><i class="fa fa-check"></i><b>5.1.4</b> Installing and loading packages</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#experimental-design"><i class="fa fa-check"></i><b>5.2</b> Experimental design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#balanced-designs"><i class="fa fa-check"></i><b>5.2.1</b> Balanced designs</a></li>
<li class="chapter" data-level="5.2.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#blocking-factors-and-random-effects"><i class="fa fa-check"></i><b>5.2.2</b> Blocking factors and random effects</a></li>
<li class="chapter" data-level="5.2.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#randomization"><i class="fa fa-check"></i><b>5.2.3</b> Randomization</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#analysis-of-variance-anova"><i class="fa fa-check"></i><b>5.3</b> Analysis of Variance (ANOVA)</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#key-assumptions"><i class="fa fa-check"></i><b>5.3.1</b> Key assumptions</a></li>
<li class="chapter" data-level="5.3.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#the-gist-of-the-math"><i class="fa fa-check"></i><b>5.3.2</b> The gist of the math</a></li>
<li class="chapter" data-level="5.3.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#way-anova-with-2-groups"><i class="fa fa-check"></i><b>5.3.3</b> 1-way ANOVA with 2 groups</a></li>
<li class="chapter" data-level="5.3.4" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#formula-notation-in-r"><i class="fa fa-check"></i><b>5.3.4</b> Formula notation in R</a></li>
<li class="chapter" data-level="5.3.5" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#anova-in-r"><i class="fa fa-check"></i><b>5.3.5</b> ANOVA in R</a></li>
<li class="chapter" data-level="5.3.6" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#way-anova-with-2-groups-1"><i class="fa fa-check"></i><b>5.3.6</b> 1-way ANOVA with &gt; 2 groups</a></li>
<li class="chapter" data-level="5.3.7" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#reload-and-explore-the-data"><i class="fa fa-check"></i><b>5.3.7</b> Reload and explore the data</a></li>
<li class="chapter" data-level="5.3.8" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#assess-which-groups-differ"><i class="fa fa-check"></i><b>5.3.8</b> Assess which groups differ</a></li>
<li class="chapter" data-level="5.3.9" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#way-anova-with-2-groups-2"><i class="fa fa-check"></i><b>5.3.9</b> 2-way ANOVA with 2 groups</a></li>
<li class="chapter" data-level="5.3.10" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#way-anova-with-2-groups-including-an-interaction-term"><i class="fa fa-check"></i><b>5.3.10</b> 2-way ANOVA with 2 groups including an interaction term</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#linear-regression"><i class="fa fa-check"></i><b>5.4</b> Linear regression</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#load-and-explore-the-data-1"><i class="fa fa-check"></i><b>5.4.1</b> Load and explore the data</a></li>
<li class="chapter" data-level="5.4.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#linear-models"><i class="fa fa-check"></i><b>5.4.2</b> Linear models</a></li>
<li class="chapter" data-level="5.4.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#key-assumptions-1"><i class="fa fa-check"></i><b>5.4.3</b> Key assumptions</a></li>
<li class="chapter" data-level="5.4.4" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#simple-linear-regression"><i class="fa fa-check"></i><b>5.4.4</b> Simple linear regression</a></li>
<li class="chapter" data-level="5.4.5" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#residuals"><i class="fa fa-check"></i><b>5.4.5</b> Residuals</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#cautions-when-using-linear-models"><i class="fa fa-check"></i><b>5.5</b> Cautions when using linear models</a></li>
<li class="chapter" data-level="5.6" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#multiple-linear-regression"><i class="fa fa-check"></i><b>5.6</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#multiple-is-the-formula-not-the-predictor"><i class="fa fa-check"></i><b>5.6.1</b> Multiple is the formula, not the predictor</a></li>
<li class="chapter" data-level="5.6.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#transforming-predictors-log"><i class="fa fa-check"></i><b>5.6.2</b> Transforming predictors: log</a></li>
<li class="chapter" data-level="5.6.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#transforming-predictors-polynomial"><i class="fa fa-check"></i><b>5.6.3</b> Transforming predictors: polynomial</a></li>
<li class="chapter" data-level="5.6.4" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#interactions-and-analysis-of-covarianvce-ancova"><i class="fa fa-check"></i><b>5.6.4</b> Interactions and ANalysis of COVArianvce (ANCOVA)</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#linear-mixed-effects-models"><i class="fa fa-check"></i><b>5.7</b> Linear Mixed Effects models</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#motivations-for-lme"><i class="fa fa-check"></i><b>5.7.1</b> Motivations for LME</a></li>
<li class="chapter" data-level="5.7.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#definitions"><i class="fa fa-check"></i><b>5.7.2</b> Definitions</a></li>
<li class="chapter" data-level="5.7.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#fitting-lme"><i class="fa fa-check"></i><b>5.7.3</b> Fitting LME</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#generalized-linear-models"><i class="fa fa-check"></i><b>5.8</b> Generalized Linear models</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#definition"><i class="fa fa-check"></i><b>5.8.1</b> Definition</a></li>
<li class="chapter" data-level="5.8.2" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#fitting-glms"><i class="fa fa-check"></i><b>5.8.2</b> Fitting GLMs</a></li>
<li class="chapter" data-level="5.8.3" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#logistic-regression-family-binomial"><i class="fa fa-check"></i><b>5.8.3</b> Logistic regression (<code>family = binomial</code>)</a></li>
<li class="chapter" data-level="5.8.4" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#count-data-family-poisson"><i class="fa fa-check"></i><b>5.8.4</b> Count data (<code>family = poisson</code>)</a></li>
<li class="chapter" data-level="5.8.5" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#negative-binomial-model-for-count-data"><i class="fa fa-check"></i><b>5.8.5</b> Negative binomial model for count data</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="statistical-models-in-r-1.html"><a href="statistical-models-in-r-1.html#survey-3"><i class="fa fa-check"></i><b>5.9</b> Survey</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html"><i class="fa fa-check"></i><b>6</b> Intermediate R programming</a>
<ul>
<li class="chapter" data-level="6.1" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#setup-instructions-2"><i class="fa fa-check"></i><b>6.1.1</b> Setup instructions</a></li>
<li class="chapter" data-level="6.1.2" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#background-2"><i class="fa fa-check"></i><b>6.1.2</b> Background</a></li>
<li class="chapter" data-level="6.1.3" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#data-description-2"><i class="fa fa-check"></i><b>6.1.3</b> Data description</a></li>
<li class="chapter" data-level="6.1.4" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#making-an-rstudio-project-2"><i class="fa fa-check"></i><b>6.1.4</b> Making an RStudio project</a></li>
<li class="chapter" data-level="6.1.5" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#installing-and-loading-packages-3"><i class="fa fa-check"></i><b>6.1.5</b> Installing and loading packages</a></li>
<li class="chapter" data-level="6.1.6" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#downloading-data"><i class="fa fa-check"></i><b>6.1.6</b> Downloading data</a></li>
<li class="chapter" data-level="6.1.7" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#load-data"><i class="fa fa-check"></i><b>6.1.7</b> Load data</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#objects-classes-and-attributes"><i class="fa fa-check"></i><b>6.2</b> Objects, classes, and attributes</a></li>
<li class="chapter" data-level="6.3" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#s3-objects"><i class="fa fa-check"></i><b>6.3</b> S3 objects</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#vectors-1"><i class="fa fa-check"></i><b>6.3.1</b> Vectors</a></li>
<li class="chapter" data-level="6.3.2" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#complex-objects"><i class="fa fa-check"></i><b>6.3.2</b> Complex objects</a></li>
<li class="chapter" data-level="6.3.3" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#data-objects"><i class="fa fa-check"></i><b>6.3.3</b> Data objects</a></li>
<li class="chapter" data-level="6.3.4" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#the-r-list-object"><i class="fa fa-check"></i><b>6.3.4</b> The R list object</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#s4-objects"><i class="fa fa-check"></i><b>6.4</b> S4 objects</a></li>
<li class="chapter" data-level="6.5" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#functions-1"><i class="fa fa-check"></i><b>6.5</b> Functions</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#basics"><i class="fa fa-check"></i><b>6.5.1</b> Basics</a></li>
<li class="chapter" data-level="6.5.2" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#arguments"><i class="fa fa-check"></i><b>6.5.2</b> Arguments</a></li>
<li class="chapter" data-level="6.5.3" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#triple-dot-argument"><i class="fa fa-check"></i><b>6.5.3</b> Triple-dot argument</a></li>
<li class="chapter" data-level="6.5.4" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#scoping"><i class="fa fa-check"></i><b>6.5.4</b> Scoping</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#building-a-function"><i class="fa fa-check"></i><b>6.6</b> Building a function</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-1.-define-and-test-your-task"><i class="fa fa-check"></i><b>6.6.1</b> Step 1. Define and test your task</a></li>
<li class="chapter" data-level="6.6.2" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-3-add-packages"><i class="fa fa-check"></i><b>6.6.2</b> Step 3: Add packages</a></li>
<li class="chapter" data-level="6.6.3" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-4-start-you-r-documentation"><i class="fa fa-check"></i><b>6.6.3</b> Step 4: Start you r documentation</a></li>
<li class="chapter" data-level="6.6.4" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-5-loop-through-multiple-y-variables"><i class="fa fa-check"></i><b>6.6.4</b> Step 5: Loop through multiple y-variables</a></li>
<li class="chapter" data-level="6.6.5" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-6-save-results-to-a-table"><i class="fa fa-check"></i><b>6.6.5</b> Step 6: Save results to a table</a></li>
<li class="chapter" data-level="6.6.6" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-6.1-save-all-iterations-of-the-loop"><i class="fa fa-check"></i><b>6.6.6</b> Step 6.1: Save all iterations of the loop</a></li>
<li class="chapter" data-level="6.6.7" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-6.2-beautify-the-output"><i class="fa fa-check"></i><b>6.6.7</b> Step 6.2 Beautify the output</a></li>
<li class="chapter" data-level="6.6.8" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#step-7-complete-documentation"><i class="fa fa-check"></i><b>6.6.8</b> Step 7: Complete documentation</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#packages"><i class="fa fa-check"></i><b>6.7</b> Packages</a></li>
<li class="chapter" data-level="6.8" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#creating-a-package-project"><i class="fa fa-check"></i><b>6.8</b> Creating a package project</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#description"><i class="fa fa-check"></i><b>6.8.1</b> Description</a></li>
<li class="chapter" data-level="6.8.2" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#r"><i class="fa fa-check"></i><b>6.8.2</b> R/</a></li>
<li class="chapter" data-level="6.8.3" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#man"><i class="fa fa-check"></i><b>6.8.3</b> man/</a></li>
<li class="chapter" data-level="6.8.4" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#namespace"><i class="fa fa-check"></i><b>6.8.4</b> Namespace</a></li>
<li class="chapter" data-level="6.8.5" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#adding-imports-and-exports"><i class="fa fa-check"></i><b>6.8.5</b> Adding imports and exports</a></li>
<li class="chapter" data-level="6.8.6" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#test-your-package"><i class="fa fa-check"></i><b>6.8.6</b> Test your package</a></li>
<li class="chapter" data-level="6.8.7" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#test-your-package-again"><i class="fa fa-check"></i><b>6.8.7</b> Test your package again</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#further-resources"><i class="fa fa-check"></i><b>6.9</b> Further resources</a></li>
<li class="chapter" data-level="6.10" data-path="intermediate-r-programming-1.html"><a href="intermediate-r-programming-1.html#survey-4"><i class="fa fa-check"></i><b>6.10</b> Survey</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">ECOSCOPE: Data Science Workshops</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intermediate-r-programming-1" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Intermediate R programming</h1>
<div id="introduction-4" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction</h2>
<p>In this workshop, you will learn to use R as a programming environment, allowing you to write more complex, yet clearer data analysis code. We will teach you three fundamental concepts of R programming: classes, functions, and packages.</p>
<p>You will learn how to:</p>
<ul>
<li>access specific parts of an object and its attributes,</li>
<li>use different classes of objects in generic R functions,</li>
<li>create your own generic functions,</li>
<li>structure a package and package libraries, and</li>
<li>create your own package and distribute it to other R users.</li>
</ul>
<p>This is an intermediate workshop series that assumes prior experience with R (such as that in our <a href="https://github.com/EDUCE-UBC/workshops_R/tree/main/intro_R_2hr">Introduction to R workshop</a>).</p>
<div id="setup-instructions-2" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Setup instructions</h3>
<p>Please come to the workshop with your laptop setup with the required software and data files as described in our <a href="setup/intermediate/intermedR_setup.html">setup instructions</a>.</p>
</div>
<div id="background-2" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Background</h3>
<p>Please read <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5663219/">Hallam SJ <em>et al</em>. 2017. Sci Data 4: 170158</a> “Monitoring microbial responses to ocean deoxygenation in a model oxygen minimum zone” to learn more about the data used in this workshop. You can also check out this <a href="https://youtu.be/XYQSm2Me86I">short video</a> showing how the sampling was done!</p>
</div>
<div id="data-description-2" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Data description</h3>
<p>The data in this workshop were collected as part of an on-going oceanographic time series program in Saanich Inlet, a seasonally anoxic fjord on the East coast of Vancouver Island, British Columbia (Figure 1).</p>
<p><br>
<br>
<img src="images/intermediate/Saanich.png" style="width:4in" />
/</p>
<p><strong>Figure 1.</strong> Map of Saanich Inlet indicating conventional sample collection stations (S1-S9). Data used in this workshop is sourced from S3.
<br>
<br></p>
<p>Saanich Inlet is a steep sided fjord characterized by a shallow glacial sill located at the mouth of the inlet that restricts circulation in basin waters below 100 m (Figure 2).</p>
<p><br>
<br>
<img src="images/intermediate/Inlet_structure.png" />
/</p>
<p><strong>Figure 2.</strong> Structure of Saanich Inlet. The glacial sill restricts water circulation into and out of the lower depth of the inlet basin.
<br>
<br></p>
<p>During spring and summer months, elevated primary production (like photosynthesis) in surface waters combined with restricted circulation results in progressive water column stratification and complete oxygen starvation (anoxia) in deep basin waters. In late summer, pulses of oxygenated nutrient-rich ocean waters upwelling from the Haro Straight cascade over the sill, displacing oxygen starved bottom waters upward. The intensity of these renewal events varies from year to year with implications for microbial ecology and biogeochemical cycles (Figure 3).</p>
<p><br>
<br>
<img src="images/intermediate/oxygen_timeseries.png" />
/</p>
<p><strong>Figure 3.</strong> Contour plot of water column oxygen concentrations over multiple years in the time series. Warmer colors indicate high oxygen concentrations while cooler colors are low. Note the recurring pattern of oxygen decline below 100 m depth intervals followed by seasonal renewal events in late Summer into early Fall carrying more oxygenated waters into the Inlet.
<br>
<br></p>
<p>The seasonal cycle of stratification and deep water renewal enables spatial and temporal profiling across a wide range of water column energy states and nutrients, thus making Saanich Inlet a model ecosystem for studying microbial community responses to ocean deoxygenation. Ocean deoxygenation is a widespread phenomenon currently increasing due to climate change.</p>
<p>The data we will use in this workshop include various geochemical measurements at many depths in Saanich Inlet. Samples were taken approximately monthly from 2006 to 2014, though there is much missing data to contend with.</p>
<p>For a brief introduction to the data used in this workshop series, see <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5663219/">Hallam SJ <em>et al</em>. 2017. Sci Data 4: 170158</a> “Monitoring microbial responses to ocean deoxygenation in a model oxygen minimum zone.” More detailed information on the environmental context and time series data can be found in <a href="https://www.nature.com/articles/sdata2017159">Torres-Beltrán M <em>et al</em>. 2017. Sci Data 4: 170159.</a> “A compendium of geochemical information from the Saanich Inlet water column.”</p>
</div>
<div id="making-an-rstudio-project-2" class="section level3" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Making an RStudio project</h3>
<p>Projects allow you to divide your work into self-contained contexts.</p>
<p>Let’s create a project to work in.</p>
<p>In the top-right corner of your RStudio window, click the “Project: (None)” button to show the projects dropdown menu. Select “New Project…” &gt; “New Directory” &gt; “New Project.” Under directory name, input “intermediate_R” and choose a parent directory to contain this project on your computer.</p>
</div>
<div id="installing-and-loading-packages-3" class="section level3" number="6.1.5">
<h3><span class="header-section-number">6.1.5</span> Installing and loading packages</h3>
<p>At the beginning of every R script, you should have a dedicated space for loading R packages. R packages allow any R user to code reproducible functions and share them with the R community. Packages exist for anything ranging from microbial ecology to complex graphics to multivariate modeling and beyond.</p>
<p>In this workshop, we will use several packages within the <a href="https://www.tidyverse.org/">tidyverse</a> as well as several development tools listed below.</p>
<p>Here, we load the necessary packages which <em>must already be installed</em> (see <a href="setup/intermedR_setup.html">setup instructions</a> for details).</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="intermediate-r-programming-1.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># Easily Install and Load the &#39;Tidyverse&#39;</span></span>
<span id="cb339-2"><a href="intermediate-r-programming-1.html#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest) <span class="co"># Tests in Linear Mixed Effects Models</span></span>
<span id="cb339-3"><a href="intermediate-r-programming-1.html#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools) <span class="co"># Tools to Make Developing R Packages Easier</span></span>
<span id="cb339-4"><a href="intermediate-r-programming-1.html#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(roxygen2) <span class="co"># In-Line Documentation for R</span></span>
<span id="cb339-5"><a href="intermediate-r-programming-1.html#cb339-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat) <span class="co"># Unit Testing for R</span></span>
<span id="cb339-6"><a href="intermediate-r-programming-1.html#cb339-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(usethis) <span class="co"># Automate Package and Project Setup</span></span></code></pre></div>
</div>
<div id="downloading-data" class="section level3" number="6.1.6">
<h3><span class="header-section-number">6.1.6</span> Downloading data</h3>
<p>The following command downloads the data from our <a href="https://github.com/EDUCE-UBC/workshops_access">GitHub</a> and since you’re working in a Project, saves it in the Project directory under the <code>data</code> directory on your computer.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="intermediate-r-programming-1.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb340-2"><a href="intermediate-r-programming-1.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/EDUCE-UBC/educer/main/data-raw/data_intermediate_ws.csv&quot;</span>),</span>
<span id="cb340-3"><a href="intermediate-r-programming-1.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;data/Saanich_Data_clean.csv&quot;</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="load-data" class="section level3" number="6.1.7">
<h3><span class="header-section-number">6.1.7</span> Load data</h3>
<p>Let’s start by reading in the data we will use for this workshop. Here, we specify that the data file is named “Saanich_Data_clean.csv.” Furthermore, we specify that the first row of the data contain variable names, and that empty, NA, NAN, or ND values should be treated by R as missing data (coded in R as NA).</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="intermediate-r-programming-1.html#cb341-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file=</span><span class="st">&quot;data/Saanich_Data_clean.csv&quot;</span>,</span>
<span id="cb341-2"><a href="intermediate-r-programming-1.html#cb341-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names=</span><span class="cn">TRUE</span>,</span>
<span id="cb341-3"><a href="intermediate-r-programming-1.html#cb341-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">na=</span><span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;NAN&quot;</span>, <span class="st">&quot;ND&quot;</span>))</span></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   Cruise = col_double(),
##   Date = col_date(format = &quot;&quot;),
##   Depth = col_double(),
##   O2_uM = col_double(),
##   NO3_uM = col_double(),
##   H2S_uM = col_double(),
##   Depth_m = col_double()
## )</code></pre>
<p><em>If you would like to learn more about how these data were cleaned and manipulated, please see our <a href="https://github.com/EDUCE-UBC/workshops_R/tree/main/intro_tidyverse">R tidyverse workshop</a>.</em></p>
</div>
</div>
<div id="objects-classes-and-attributes" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Objects, classes, and attributes</h2>
<p>Practically speaking, everything you encounter in R is an object.</p>
<ul>
<li>Everything your store in your work-space is an object.</li>
<li>Built-in functions are objects.</li>
<li>Data sets are objects.</li>
<li>ggplot2 graphics are objects (base R graphics are not).</li>
</ul>
<p>Every object has a <strong>class</strong>, and many objects have <strong>attributes</strong>. You can use the <code>class</code> function to determine an objects class and the <code>attributes</code> function to see its attributes.</p>
</div>
<div id="s3-objects" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> S3 objects</h2>
<div id="vectors-1" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Vectors</h3>
<p>Vectors are the most common type of object in R. In fact, a scalar is a vector of length 1, and matrix is a vector of vectors! Once you store a vector in your R environment, you have created an R object and…</p>
<ul>
<li>Every object has a mode and storage mode.</li>
<li>Vectors have an inherent class based on their mode.</li>
</ul>
<p>There are 5 data types that are stored in basic (atomic) vectors</p>
<table>
<thead>
<tr class="header">
<th><strong>class</strong></th>
<th><strong>mode</strong></th>
<th><strong>storage.mode</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>numeric</td>
<td>numeric</td>
<td>double</td>
</tr>
<tr class="even">
<td>integer</td>
<td>numeric</td>
<td>integer</td>
</tr>
<tr class="odd">
<td>character</td>
<td>character</td>
<td>character</td>
</tr>
<tr class="even">
<td>logical</td>
<td>logical</td>
<td>logical</td>
</tr>
<tr class="odd">
<td>complex</td>
<td>varies</td>
<td>varies</td>
</tr>
</tbody>
</table>
<div id="numeric" class="section level4" number="6.3.1.1">
<h4><span class="header-section-number">6.3.1.1</span> Numeric</h4>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="intermediate-r-programming-1.html#cb343-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb343-2"><a href="intermediate-r-programming-1.html#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="intermediate-r-programming-1.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
</div>
<div id="integer" class="section level4" number="6.3.1.2">
<h4><span class="header-section-number">6.3.1.2</span> Integer</h4>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="intermediate-r-programming-1.html#cb347-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> 1L</span>
<span id="cb347-2"><a href="intermediate-r-programming-1.html#cb347-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="intermediate-r-programming-1.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
</div>
<div id="character" class="section level4" number="6.3.1.3">
<h4><span class="header-section-number">6.3.1.3</span> Character</h4>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="intermediate-r-programming-1.html#cb351-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;1L&quot;</span></span>
<span id="cb351-2"><a href="intermediate-r-programming-1.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="intermediate-r-programming-1.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
</div>
<div id="logical" class="section level4" number="6.3.1.4">
<h4><span class="header-section-number">6.3.1.4</span> Logical</h4>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="intermediate-r-programming-1.html#cb355-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb355-2"><a href="intermediate-r-programming-1.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="intermediate-r-programming-1.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
</div>
<div id="matrix-complex" class="section level4" number="6.3.1.5">
<h4><span class="header-section-number">6.3.1.5</span> Matrix (complex)</h4>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="intermediate-r-programming-1.html#cb359-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb359-2"><a href="intermediate-r-programming-1.html#cb359-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb359-3"><a href="intermediate-r-programming-1.html#cb359-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="intermediate-r-programming-1.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="intermediate-r-programming-1.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(x)</span></code></pre></div>
<pre><code>## $dim
## [1] 2 1</code></pre>
</div>
<div id="exercise-working-with-vectors" class="section level4" number="6.3.1.6">
<h4><span class="header-section-number">6.3.1.6</span> Exercise: Working with vectors</h4>
<ol style="list-style-type: decimal">
<li>Assign x the value <code>"a"</code>. What are its class and mode?</li>
<li>Give it dimensions <code>c(1,1)</code>. What are its class and mode?</li>
</ol>
</div>
</div>
<div id="complex-objects" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Complex objects</h3>
<p>Complex objects can be vectors at heart (like the matrix above) but not all are. Since everything in R is an object, you can determine the class and attributes of pretty much anything in R.</p>
<div id="built-in-functions" class="section level4" number="6.3.2.1">
<h4><span class="header-section-number">6.3.2.1</span> Built in functions</h4>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="intermediate-r-programming-1.html#cb365-1" aria-hidden="true" tabindex="-1"></a>class</span></code></pre></div>
<pre><code>## function (x)  .Primitive(&quot;class&quot;)</code></pre>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="intermediate-r-programming-1.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(class)</span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="intermediate-r-programming-1.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(class)</span></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="graphics" class="section level4" number="6.3.2.2">
<h4><span class="header-section-number">6.3.2.2</span> Graphics</h4>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="intermediate-r-programming-1.html#cb371-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb371-2"><a href="intermediate-r-programming-1.html#cb371-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>O2_uM, <span class="at">y=</span>Depth_m)) <span class="sc">+</span></span>
<span id="cb371-3"><a href="intermediate-r-programming-1.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb371-4"><a href="intermediate-r-programming-1.html#cb371-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> </span>
<span id="cb371-5"><a href="intermediate-r-programming-1.html#cb371-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb371-6"><a href="intermediate-r-programming-1.html#cb371-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="fu">expression</span>(O[<span class="dv">2</span>]<span class="sc">*</span><span class="st">&quot; &quot;</span><span class="sc">*</span>(mu<span class="sc">*</span>g<span class="sc">/</span>mL)),</span>
<span id="cb371-7"><a href="intermediate-r-programming-1.html#cb371-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">&quot;Depth (m)&quot;</span>, </span>
<span id="cb371-8"><a href="intermediate-r-programming-1.html#cb371-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">&quot;Oxygen decreases with depth and is less variable at lower depths&quot;</span>)</span>
<span id="cb371-9"><a href="intermediate-r-programming-1.html#cb371-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-10"><a href="intermediate-r-programming-1.html#cb371-10" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="ecoscope_datascience_workshops_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="intermediate-r-programming-1.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(p1)</span></code></pre></div>
<pre><code>## [1] &quot;gg&quot;     &quot;ggplot&quot;</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="intermediate-r-programming-1.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(p1)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;data&quot;        &quot;layers&quot;      &quot;scales&quot;      &quot;mapping&quot;     &quot;theme&quot;      
## [6] &quot;coordinates&quot; &quot;facet&quot;       &quot;plot_env&quot;    &quot;labels&quot;     
## 
## $class
## [1] &quot;gg&quot;     &quot;ggplot&quot;</code></pre>
</div>
<div id="statistical-models" class="section level4" number="6.3.2.3">
<h4><span class="header-section-number">6.3.2.3</span> Statistical models</h4>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="intermediate-r-programming-1.html#cb377-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(O2_uM <span class="sc">~</span> Depth_m, <span class="at">data=</span>dat)</span>
<span id="cb377-2"><a href="intermediate-r-programming-1.html#cb377-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-3"><a href="intermediate-r-programming-1.html#cb377-3" aria-hidden="true" tabindex="-1"></a>m1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = O2_uM ~ Depth_m, data = dat)
## 
## Coefficients:
## (Intercept)      Depth_m  
##     190.527       -1.184</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="intermediate-r-programming-1.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(m1)</span></code></pre></div>
<pre><code>## [1] &quot;lm&quot;</code></pre>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="intermediate-r-programming-1.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(m1)</span></code></pre></div>
<pre><code>## $names
##  [1] &quot;coefficients&quot;  &quot;residuals&quot;     &quot;effects&quot;       &quot;rank&quot;         
##  [5] &quot;fitted.values&quot; &quot;assign&quot;        &quot;qr&quot;            &quot;df.residual&quot;  
##  [9] &quot;xlevels&quot;       &quot;call&quot;          &quot;terms&quot;         &quot;model&quot;        
## 
## $class
## [1] &quot;lm&quot;</code></pre>
</div>
<div id="summaries" class="section level4" number="6.3.2.4">
<h4><span class="header-section-number">6.3.2.4</span> Summaries</h4>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="intermediate-r-programming-1.html#cb383-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(m1)</span>
<span id="cb383-2"><a href="intermediate-r-programming-1.html#cb383-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-3"><a href="intermediate-r-programming-1.html#cb383-3" aria-hidden="true" tabindex="-1"></a>s1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = O2_uM ~ Depth_m, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -173.900  -32.462   -2.995   31.631  164.641 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 190.52676    2.63921   72.19   &lt;2e-16 ***
## Depth_m      -1.18384    0.02274  -52.06   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 43.25 on 1247 degrees of freedom
## Multiple R-squared:  0.6849, Adjusted R-squared:  0.6847 
## F-statistic:  2711 on 1 and 1247 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="intermediate-r-programming-1.html#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(s1)</span></code></pre></div>
<pre><code>## [1] &quot;summary.lm&quot;</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="intermediate-r-programming-1.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(s1)</span></code></pre></div>
<pre><code>## $names
##  [1] &quot;call&quot;          &quot;terms&quot;         &quot;residuals&quot;     &quot;coefficients&quot; 
##  [5] &quot;aliased&quot;       &quot;sigma&quot;         &quot;df&quot;            &quot;r.squared&quot;    
##  [9] &quot;adj.r.squared&quot; &quot;fstatistic&quot;    &quot;cov.unscaled&quot; 
## 
## $class
## [1] &quot;summary.lm&quot;</code></pre>
</div>
</div>
<div id="data-objects" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> Data objects</h3>
<p>Data sets are also complex objects that can be stored as several different classes in R - some vector-based, some not.</p>
<p>In general, data sets are organized into what we would call a “table” outside of R (something with rows and columns). However, in R, a “table” can be stored as several different classes: table, matrix, data frame, tibble, or array. Though they may contain the same information, each has specific characteristics and attributes that impact how functions interact with it.</p>
<div id="table-matrix-data-frame-tibble-or-array" class="section level4" number="6.3.3.1">
<h4><span class="header-section-number">6.3.3.1</span> Table, matrix, data frame, tibble, or array?</h4>
<p>So, which class should be used for a given data set? In general:</p>
<ul>
<li><strong>Matrices</strong>, <strong>data frames</strong>, and <strong>tibbles</strong> are what we traditionally think of as a table with rows and columns.</li>
<li><strong>Tables</strong> are a specific type of data frame like summaries or contingency tables.</li>
<li><strong>Arrays</strong> are vectors with a dimensions attribute like a vector that contains 2 data frames.</li>
</ul>
<p>Practically speaking, the data sets you will work with will be matrices, data frames, or tibbles, and you will only encounter tables and arrays as outputs of analyses in R. Thus, you only need to decide between 3 classes for your data.</p>
</div>
<div id="matrix-data-frame-or-tibble" class="section level4" number="6.3.3.2">
<h4><span class="header-section-number">6.3.3.2</span> Matrix, data frame, or tibble?</h4>
<p>And in fact, a tibble is just how a data frame is stored in the tidyverse. For all intents and purposes, <strong>a tibble is a data frame</strong>. Functionally, they are the same and should be considered equivalent when used in R. Tibbles merely simplify data frames a little by:</p>
<ul>
<li>Printing only the first ten rows and all the columns that fit on one screen in the console (making large data frames easier to work with)</li>
<li>Subsetting to another tibble no matter what (data frames sometimes subset to another data frame, sometimes to a vector)</li>
</ul>
<p>Thus, you only really need to decide between 2 classes for your data.</p>
</div>
<div id="data-frame-or-matrix" class="section level4" number="6.3.3.3">
<h4><span class="header-section-number">6.3.3.3</span> Data frame or matrix?</h4>
<p>To answer this, let’s take a look at our Saanich data. Currently these data are stored in our R environment as a <strong>tibble (<em>i.e.</em> data frame)</strong> because we read them in using the tidyverse function <code>read_csv</code>.</p>
<p>We will subset to only the first 5 rows and columns so that we can see the attributes of these data more easily.</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="intermediate-r-programming-1.html#cb389-1" aria-hidden="true" tabindex="-1"></a>dat.df <span class="ot">&lt;-</span> dat[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb389-2"><a href="intermediate-r-programming-1.html#cb389-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-3"><a href="intermediate-r-programming-1.html#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat.df)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>We can reformat these data to a <strong>matrix</strong>.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="intermediate-r-programming-1.html#cb391-1" aria-hidden="true" tabindex="-1"></a>dat.mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dat.df)</span>
<span id="cb391-2"><a href="intermediate-r-programming-1.html#cb391-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-3"><a href="intermediate-r-programming-1.html#cb391-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat.mat)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot; &quot;array&quot;</code></pre>
<p>When we look at the data in these two formats, they look the same.</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="intermediate-r-programming-1.html#cb393-1" aria-hidden="true" tabindex="-1"></a>dat.df</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   Cruise Date       Depth O2_uM NO3_uM
##    &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     18 2008-02-13 0.01   225.   18.9
## 2     18 2008-02-13 0.02   221.   24.0
## 3     18 2008-02-13 0.04   202.   29.2
## 4     18 2008-02-13 0.06   198.   24.0
## 5     18 2008-02-13 0.075  194.   23.8</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="intermediate-r-programming-1.html#cb395-1" aria-hidden="true" tabindex="-1"></a>dat.mat</span></code></pre></div>
<pre><code>##      Cruise Date         Depth   O2_uM     NO3_uM  
## [1,] &quot;18&quot;   &quot;2008-02-13&quot; &quot;0.010&quot; &quot;225.237&quot; &quot;18.871&quot;
## [2,] &quot;18&quot;   &quot;2008-02-13&quot; &quot;0.020&quot; &quot;220.985&quot; &quot;23.974&quot;
## [3,] &quot;18&quot;   &quot;2008-02-13&quot; &quot;0.040&quot; &quot;201.769&quot; &quot;29.204&quot;
## [4,] &quot;18&quot;   &quot;2008-02-13&quot; &quot;0.060&quot; &quot;197.947&quot; &quot;23.981&quot;
## [5,] &quot;18&quot;   &quot;2008-02-13&quot; &quot;0.075&quot; &quot;193.762&quot; &quot;23.831&quot;</code></pre>
<p>But they are fundamentally different objects.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="intermediate-r-programming-1.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(dat.df)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;Cruise&quot; &quot;Date&quot;   &quot;Depth&quot;  &quot;O2_uM&quot;  &quot;NO3_uM&quot;
## 
## $row.names
## [1] 1 2 3 4 5
## 
## $class
## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="intermediate-r-programming-1.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(dat.mat)</span></code></pre></div>
<pre><code>## $dim
## [1] 5 5
## 
## $dimnames
## $dimnames[[1]]
## NULL
## 
## $dimnames[[2]]
## [1] &quot;Cruise&quot; &quot;Date&quot;   &quot;Depth&quot;  &quot;O2_uM&quot;  &quot;NO3_uM&quot;</code></pre>
<p>A matrix is a long vector with an attribute (dim) that gives an easier way to access similar items. Each row (water sample) and column (same type of measurement) should have something in common. Internally, the data stacks the columns. <strong>A matrix is accessed like a vector.</strong></p>
<p>A data frame is a special type of list. Each element of the list is a vector and each vector must be the same length. The same element number of each vector should have something in common (the same water sample). <strong>A data frame is accessed like a list.</strong></p>
<p>So, if a function works with vectors, you should use a matrix. If a function works with lists, you should use a data frame. Practically speaking, you should always store your data in a data frame/tibble so that you can work with the tidyverse and simply convert it to a matrix with <code>as.matrix</code> within any function that requires that formatting.</p>
<p>Also, R can tell you the functions that work on a given class with <code>methods</code>, which will show you functions that are loaded and can run on the given class type. A package has to be loaded into the current R session for <code>methods</code> to list functions from that package that would work.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="intermediate-r-programming-1.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class=</span><span class="st">&quot;data.frame&quot;</span>)</span></code></pre></div>
<pre><code>##   [1] [                 [[                [[&lt;-              [&lt;-              
##   [5] %within%          $&lt;-               aggregate         anti_join        
##   [9] anyDuplicated     anyNA             arrange_          arrange          
##  [13] as_factor         as_tibble         as.col_spec       as.data.frame    
##  [17] as.list           as.matrix         as.tbl            augment          
##  [21] auto_copy         Boxplot           brief             by               
##  [25] cbind             coerce            coerce&lt;-          collapse         
##  [29] collect           complete_         complete          compute          
##  [33] corresp           count             dim               dimnames         
##  [37] dimnames&lt;-        distinct_         distinct          do_              
##  [41] do                dplyr_col_modify  dplyr_reconstruct dplyr_row_slice  
##  [45] drop_na_          drop_na           droplevels        duplicated       
##  [49] edit              expand_           expand            extract_         
##  [53] extract           factorize         fill_             fill             
##  [57] filter_           filter            format            formula          
##  [61] fortify           full_join         gather_           gather           
##  [65] ggplot_add        glance            glimpse           group_by_        
##  [69] group_by          group_data        group_indices_    group_indices    
##  [73] group_keys        group_map         group_modify      group_nest       
##  [77] group_size        group_split       group_trim        group_vars       
##  [81] groups            head              HSAURtable        initialize       
##  [85] inner_join        intersect         is.na             lda              
##  [89] left_join         loglm1            Math              merge            
##  [93] mutate_           mutate            n_groups          na.contiguous    
##  [97] na.exclude        na.omit           nest_by           nest_join        
## [101] nest_legacy       nest              Ops               pivot_longer     
## [105] pivot_wider       plot              print             prompt           
## [109] pull              qda               rbind             relocate         
## [113] rename_           rename_with       rename            replace_na       
## [117] right_join        row.names         row.names&lt;-       rows_delete      
## [121] rows_insert       rows_patch        rows_update       rows_upsert      
## [125] rowsum            rowwise           S                 same_src         
## [129] sample_frac       sample_n          select_           select           
## [133] semi_join         separate_         separate_rows_    separate_rows    
## [137] separate          setdiff           setequal          show             
## [141] slice_            slice_head        slice_max         slice_min        
## [145] slice_sample      slice_tail        slice             slotsFromS3      
## [149] some              split             split&lt;-           spread_          
## [153] spread            stack             str               strings2factors  
## [157] subset            summarise_        summarise         summary          
## [161] Summary           t                 tail              tally            
## [165] tbl_vars          tidy              transform         transmute_       
## [169] transmute         type.convert      ungroup           union_all        
## [173] union             unique            unite_            unite            
## [177] unnest_legacy     unnest            unstack           whichNames       
## [181] within           
## see &#39;?methods&#39; for accessing help and source code</code></pre>
</div>
<div id="exercise-class-and-attributes" class="section level4" number="6.3.3.4">
<h4><span class="header-section-number">6.3.3.4</span> Exercise: Class and attributes</h4>
<ol style="list-style-type: decimal">
<li>Obtain the summary table of <code>dat</code>. What are its class and attributes?</li>
<li>Read in the data table <code>Saanich_Data.csv</code> using the base R function <code>read.table</code>. What are this object’s class and attributes? Are they any different from the object create when we used <code>read_csv</code> to read in the same data?</li>
</ol>
</div>
</div>
<div id="the-r-list-object" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> The R list object</h3>
<p>You have already worked with an R list object - the data frame. When you call a specific variable in a data frame with <code>dataframe$variable</code>, you are actually calling the vector of the <code>variable</code> contained within the <strong>list of vectors</strong> that make up the <code>dataframe.</code> This can apply more generally to any list object with <code>listName$elementName</code>.</p>
<p>So, what is a list? Simply speaking, it is a more complicated vector. Like a basic vector, it can contain any number of elements including zero. Unlike a basic vector, where each element is a single piece of data of the same type, each element of a list can be any R object and each object can be a different type. A list can even contain an object that is itself a list!</p>
<p>Being able to contain objects of different types also differentiates lists from arrays since arrays are vectors requiring all elements to be the same type.</p>
<p>For example, we can make a list that contains a variety of objects like so.</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="intermediate-r-programming-1.html#cb403-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">data =</span> dat,</span>
<span id="cb403-2"><a href="intermediate-r-programming-1.html#cb403-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">Function =</span> lm,</span>
<span id="cb403-3"><a href="intermediate-r-programming-1.html#cb403-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> m1,</span>
<span id="cb403-4"><a href="intermediate-r-programming-1.html#cb403-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">random =</span> <span class="fu">list</span>(<span class="fu">sample</span>(LETTERS, <span class="dv">5</span>), <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="dv">5</span>)))</span>
<span id="cb403-5"><a href="intermediate-r-programming-1.html#cb403-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-6"><a href="intermediate-r-programming-1.html#cb403-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="intermediate-r-programming-1.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="intermediate-r-programming-1.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x)</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="intermediate-r-programming-1.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(x)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;data&quot;     &quot;Function&quot; &quot;model&quot;    &quot;random&quot;</code></pre>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="intermediate-r-programming-1.html#cb411-1" aria-hidden="true" tabindex="-1"></a>x<span class="sc">$</span>random</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;I&quot; &quot;G&quot; &quot;Y&quot; &quot;J&quot; &quot;V&quot;
## 
## [[2]]
## [1] 919 538 235 289 185</code></pre>
<p><em>Due to the random nature of <code>sample</code>, your letters and numbers in <code>random</code> may be different.</em></p>
<p>Similarly, we can pull out pieces of statistical model fitted in R since the output is a list object. For example, we previously fit a linear model of oxygen by depth with <code>m1 &lt;- lm(O2 ~ Depth, data=dat)</code>. If we wanted to see only the coefficients of this model, we would use</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="intermediate-r-programming-1.html#cb413-1" aria-hidden="true" tabindex="-1"></a>m1<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>## (Intercept)     Depth_m 
##  190.526759   -1.183835</code></pre>
<div id="exercise-r-lists" class="section level4" number="6.3.4.1">
<h4><span class="header-section-number">6.3.4.1</span> Exercise: R lists</h4>
<ol style="list-style-type: decimal">
<li>Obtain the <code>summary()</code> of <code>m1</code> and save it as <code>m2</code>.</li>
<li>What is the class and mode of <code>m2</code>?</li>
<li>Using a single line of code, pull out just the p-values from <code>m2</code>.
<ul>
<li><em>Hint</em>: You will need to use both <code>$</code> and <code>[ ]</code>.</li>
</ul></li>
</ol>
</div>
</div>
</div>
<div id="s4-objects" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> S4 objects</h2>
<p>So far, everything we’ve talked about has been S3 objects. However, there is another class of object in R - S4. It is up the the package developer to determine if a function outputs as an S3 or S4 object, so you may come across both classes during your data analysis.</p>
<p>S4 objects operate differently than S3, so let’s see an example with <code>lmer</code> (linear mixed effects model) from the <code>lmerTest</code> package. Here, we will determine if oxygen concentration in Saanich Inlet differs by year (represented by Cruise #) knowing that we repeatedly measured the same depths over time.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="intermediate-r-programming-1.html#cb415-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(O2_uM <span class="sc">~</span> Cruise <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> Cruise <span class="sc">|</span> Depth_m), dat)</span>
<span id="cb415-2"><a href="intermediate-r-programming-1.html#cb415-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb415-3"><a href="intermediate-r-programming-1.html#cb415-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(m3)</span></code></pre></div>
<pre><code>## [1] &quot;lmerModLmerTest&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lmerTest&quot;</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="intermediate-r-programming-1.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(m3)</span></code></pre></div>
<pre><code>## [1] &quot;S4&quot;</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="intermediate-r-programming-1.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Many of the objects in m3 are very large so we will just look at the names here</span></span>
<span id="cb419-2"><a href="intermediate-r-programming-1.html#cb419-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">attributes</span>(m3))</span></code></pre></div>
<pre><code>##  [1] &quot;vcov_varpar&quot; &quot;Jac_list&quot;    &quot;vcov_beta&quot;   &quot;sigma&quot;       &quot;resp&quot;       
##  [6] &quot;Gp&quot;          &quot;call&quot;        &quot;frame&quot;       &quot;flist&quot;       &quot;cnms&quot;       
## [11] &quot;lower&quot;       &quot;theta&quot;       &quot;beta&quot;        &quot;u&quot;           &quot;devcomp&quot;    
## [16] &quot;pp&quot;          &quot;optinfo&quot;     &quot;class&quot;</code></pre>
<p>For your purposes, the major difference between S3 and S4 is that to access S4 data, you need to use <code>@</code> instead of <code>$</code>,</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="intermediate-r-programming-1.html#cb421-1" aria-hidden="true" tabindex="-1"></a>m3<span class="sc">@</span>beta</span></code></pre></div>
<pre><code>## [1] 85.2611236 -0.5859695</code></pre>
<p>Also, elements of S4 class objects can be S3 class objects.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="intermediate-r-programming-1.html#cb423-1" aria-hidden="true" tabindex="-1"></a>VC <span class="ot">&lt;-</span> <span class="fu">VarCorr</span>(m3)</span>
<span id="cb423-2"><a href="intermediate-r-programming-1.html#cb423-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-3"><a href="intermediate-r-programming-1.html#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(VC)</span></code></pre></div>
<pre><code>## [1] &quot;VarCorr.merMod&quot;</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="intermediate-r-programming-1.html#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(VC)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;Depth_m&quot;
## 
## $sc
## [1] 44.93441
## 
## $useSc
## [1] TRUE
## 
## $class
## [1] &quot;VarCorr.merMod&quot;</code></pre>
<div id="exercise-s4-objects" class="section level4" number="6.4.0.1">
<h4><span class="header-section-number">6.4.0.1</span> Exercise: S4 objects</h4>
<ol style="list-style-type: decimal">
<li>Compute and store the variance-covariance matrix of <code>m3</code> using <code>vcov()</code>.</li>
<li>What class and mode is it?</li>
<li>What elements does it contain?</li>
<li>What are the dimensions of <code>factors</code> within this object?</li>
</ol>
</div>
</div>
<div id="functions-1" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Functions</h2>
<p>In math, a function is a rule for providing an output given some input. So, if you give a function an input, you know it will always provide the same output. So if <span class="math inline">\(f(3) = 2\)</span>, it will always be so, but it won’t tell us anything about what <span class="math inline">\(f(4)\)</span> is.</p>
<p>In software, this definition is often relaxed but not for R (most of the time). This means that you can trust a function to do the same thing every time you give it the same data. We call such a function a <strong>pure function</strong>. An example of a pure function in R is <code>sqrt(x)</code> <span class="math inline">\(= \sqrt{x}\)</span>, because it will always have the <strong>same output per input</strong>.</p>
<p>An example of a non-pure function in R is <code>setwd()</code>, because it changes the current working directory and thus, can have <strong>side-effects</strong> on other code.</p>
<p>You may want to turn your code into a function for a number of reasons. Common reasons are:</p>
<ul>
<li>To make your code more user friendly</li>
<li>To avoid duplicating code</li>
<li>To prevent mistakes and errors</li>
<li>To break a large problem into smaller chunks</li>
</ul>
<p>Here, we will build a function to test the relationship between depth and all the geochemical variables for a given cruise in the Saanich data set. This will show you several aspects of coding functions including:</p>
<ul>
<li>creating a generic function</li>
<li>for loops</li>
<li>accessing data from complex outputs</li>
<li>printing to a table</li>
<li>saving results to the hard-drive</li>
</ul>
<div id="basics" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> Basics</h3>
<p>Here is the basic syntax of a function in R.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="intermediate-r-programming-1.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(argument1, argument2) <span class="co"># &#39;function&#39; is a function that makes functions</span></span>
<span id="cb427-2"><a href="intermediate-r-programming-1.html#cb427-2" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb427-3"><a href="intermediate-r-programming-1.html#cb427-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Body </span></span>
<span id="cb427-4"><a href="intermediate-r-programming-1.html#cb427-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs when you call the function  </span></span>
<span id="cb427-5"><a href="intermediate-r-programming-1.html#cb427-5" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> argument1 <span class="sc">+</span> argument2 </span>
<span id="cb427-6"><a href="intermediate-r-programming-1.html#cb427-6" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">=</span> argument1 <span class="sc">*</span> argument2 </span>
<span id="cb427-7"><a href="intermediate-r-programming-1.html#cb427-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( a <span class="sc">+</span> b ) </span>
<span id="cb427-8"><a href="intermediate-r-programming-1.html#cb427-8" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>Functions have class <code>function</code> and are R objects just like any other.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="intermediate-r-programming-1.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="cf">function</span>(){}) </span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<p>If we author a function, it is likely that we would like to use it later. We can do this by assigning it to a variable. Let’s create a function to calculate the square of a number. We save this function as <code>f</code>.</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="intermediate-r-programming-1.html#cb430-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) </span>
<span id="cb430-2"><a href="intermediate-r-programming-1.html#cb430-2" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb430-3"><a href="intermediate-r-programming-1.html#cb430-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x<span class="sc">*</span>x)  </span>
<span id="cb430-4"><a href="intermediate-r-programming-1.html#cb430-4" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>Then, we can call this function, give it a value for <code>x</code>, and it will return x<sup>2</sup>.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="intermediate-r-programming-1.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 25</code></pre>
<p>Remember that we are only calling a function that happens to be stored in an R function. We can still view the function stored by <code>f</code>.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="intermediate-r-programming-1.html#cb433-1" aria-hidden="true" tabindex="-1"></a>f</span></code></pre></div>
<pre><code>## function(x) 
## { 
##   return(x*x)  
## }</code></pre>
<div id="exercise-writing-a-function" class="section level4" number="6.5.1.1">
<h4><span class="header-section-number">6.5.1.1</span> Exercise: Writing a function</h4>
<ol style="list-style-type: decimal">
<li>Put the following math into a function <span class="math display">\[ f(x) = 1 + 2x - 5x^2 + x^3 \]</span></li>
<li>Set x to <code>1:1000/1000*6-1</code></li>
<li>Plot the results with</li>
</ol>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="intermediate-r-programming-1.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">f</span>(x) , <span class="at">main=</span><span class="st">&quot;The answer looks like this&quot;</span>)</span></code></pre></div>
<p><img src="ecoscope_datascience_workshops_files/figure-html/unnamed-chunk-183-1.png" width="672" /></p>
</div>
</div>
<div id="arguments" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> Arguments</h3>
<p>A function’s arguments are the ‘inputs.’ You can input arguments by name or by order in your function just like you can with R’s built-in functions.</p>
<p>For example, if we create a function to calculate the division of two numbers</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="intermediate-r-programming-1.html#cb436-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(a,b){</span>
<span id="cb436-2"><a href="intermediate-r-programming-1.html#cb436-2" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">=</span> a<span class="sc">/</span>b</span>
<span id="cb436-3"><a href="intermediate-r-programming-1.html#cb436-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb436-4"><a href="intermediate-r-programming-1.html#cb436-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can either give the arguments by name, which allows us to input them in any order.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="intermediate-r-programming-1.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">a=</span><span class="dv">1</span>, <span class="at">b=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="intermediate-r-programming-1.html#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">b=</span><span class="dv">2</span>, <span class="at">a=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<p>Or we can input them without names but <em>in the same order as in the function</em>.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="intermediate-r-programming-1.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.5</code></pre>
<p>Because in this second case, a different order yields a different result.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="intermediate-r-programming-1.html#cb443-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">2</span>, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="triple-dot-argument" class="section level3" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> Triple-dot argument</h3>
<p>The triple-dot argument <code>...</code> allows you some flexibility in your custom function by allowing additional arguments not defined in the original <code>function( )</code>. These additional arguments are passed to sub-functions within the larger <code>function( )</code>.</p>
<p>A common culprit from <code>...</code> is the <code>plot</code> function. Here, we will plot the cosine of x and use <code>...</code> so that we can add parameters to the plot after the fact.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="intermediate-r-programming-1.html#cb445-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...)</span>
<span id="cb445-2"><a href="intermediate-r-programming-1.html#cb445-2" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb445-3"><a href="intermediate-r-programming-1.html#cb445-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="fu">cos</span>(x) </span>
<span id="cb445-4"><a href="intermediate-r-programming-1.html#cb445-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, y, ...)</span>
<span id="cb445-5"><a href="intermediate-r-programming-1.html#cb445-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb445-6"><a href="intermediate-r-programming-1.html#cb445-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-7"><a href="intermediate-r-programming-1.html#cb445-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span><span class="sc">/</span><span class="dv">50</span>)</span></code></pre></div>
<p><img src="ecoscope_datascience_workshops_files/figure-html/unnamed-chunk-188-1.png" width="384" /></p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="intermediate-r-programming-1.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span><span class="sc">/</span><span class="dv">50</span>, <span class="at">type=</span><span class="st">&#39;l&#39;</span>) </span></code></pre></div>
<p><img src="ecoscope_datascience_workshops_files/figure-html/unnamed-chunk-188-2.png" width="384" /></p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="intermediate-r-programming-1.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span><span class="sc">/</span><span class="dv">50</span>, <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">col=</span><span class="st">&quot;purple&quot;</span>) </span></code></pre></div>
<p><img src="ecoscope_datascience_workshops_files/figure-html/unnamed-chunk-188-3.png" width="384" /></p>
<p>By explicitly specifying parameters for the <code>plot</code> function, we can lazily and creatively add style to the plot without including these parameters in our original <code>function( )</code>.</p>
</div>
<div id="scoping" class="section level3" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> Scoping</h3>
<p>Scoping is a method used by R to decide what the value of a variable is. R <strong>first</strong> looks for the variable as defined in the function or its arguments and <strong>second</strong> looks for the variable in the global environment (all that stuff in the upper right panel in RStudio). There are some additional rules that exist for efficiency’s sake, but these are the ones that matter to you.</p>
<p>Thus, it is possible to define a function that references a variable that is not defined within that function. For one, you can define a variable globally and then use that variable as-is within your function.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="intermediate-r-programming-1.html#cb448-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Define z globally</span></span>
<span id="cb448-2"><a href="intermediate-r-programming-1.html#cb448-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-3"><a href="intermediate-r-programming-1.html#cb448-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="co"># no local definition of z is given</span></span>
<span id="cb448-4"><a href="intermediate-r-programming-1.html#cb448-4" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb448-5"><a href="intermediate-r-programming-1.html#cb448-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> z) </span>
<span id="cb448-6"><a href="intermediate-r-programming-1.html#cb448-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb448-7"><a href="intermediate-r-programming-1.html#cb448-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-8"><a href="intermediate-r-programming-1.html#cb448-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x=</span><span class="dv">2</span>) <span class="co"># Failing to find z in the function or inputs, R looks for it globally and finds z = 1 to result in 2 + 1 = 3</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Or you can override globally defined variables within your function.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="intermediate-r-programming-1.html#cb450-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># Define z globally</span></span>
<span id="cb450-2"><a href="intermediate-r-programming-1.html#cb450-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-3"><a href="intermediate-r-programming-1.html#cb450-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) </span>
<span id="cb450-4"><a href="intermediate-r-programming-1.html#cb450-4" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb450-5"><a href="intermediate-r-programming-1.html#cb450-5" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> <span class="dv">2</span> <span class="co"># local definition of z overrides global definition </span></span>
<span id="cb450-6"><a href="intermediate-r-programming-1.html#cb450-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> z) </span>
<span id="cb450-7"><a href="intermediate-r-programming-1.html#cb450-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb450-8"><a href="intermediate-r-programming-1.html#cb450-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-9"><a href="intermediate-r-programming-1.html#cb450-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x=</span><span class="dv">2</span>) <span class="co"># R finds the function&#39;s definition of z=2 first and thus gives 2 + 2 = 4</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>However, if your function calls for an input that is defined globally, it will fail.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="intermediate-r-programming-1.html#cb452-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb452-2"><a href="intermediate-r-programming-1.html#cb452-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-3"><a href="intermediate-r-programming-1.html#cb452-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x, z) <span class="co"># function calls for inputs for both x and z </span></span>
<span id="cb452-4"><a href="intermediate-r-programming-1.html#cb452-4" aria-hidden="true" tabindex="-1"></a>{ </span>
<span id="cb452-5"><a href="intermediate-r-programming-1.html#cb452-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> z) </span>
<span id="cb452-6"><a href="intermediate-r-programming-1.html#cb452-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb452-7"><a href="intermediate-r-programming-1.html#cb452-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-8"><a href="intermediate-r-programming-1.html#cb452-8" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x=</span><span class="dv">2</span>) <span class="co"># Function expects inputs for x and z but not finding z, fails</span></span></code></pre></div>
<pre><code>## Error in f(x = 2): argument &quot;z&quot; is missing, with no default</code></pre>
<p>Or if a variable is defined neither in the function nor in the global environment, your function will not run.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="intermediate-r-programming-1.html#cb454-1" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## [1] 4 5 6 7</code></pre>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="intermediate-r-programming-1.html#cb456-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x)</span>
<span id="cb456-2"><a href="intermediate-r-programming-1.html#cb456-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb456-3"><a href="intermediate-r-programming-1.html#cb456-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>y <span class="co"># y does not exist anywhere</span></span>
<span id="cb456-4"><a href="intermediate-r-programming-1.html#cb456-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> y)</span>
<span id="cb456-5"><a href="intermediate-r-programming-1.html#cb456-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb456-6"><a href="intermediate-r-programming-1.html#cb456-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-7"><a href="intermediate-r-programming-1.html#cb456-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">3</span>) </span></code></pre></div>
<pre><code>## [1] 11 13 15 17</code></pre>
<div id="exercise-scoping" class="section level4" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> Exercise: Scoping</h4>
<p>For the following, try to determine what the function will return <em>without running the code</em> then check yourself by running it.</p>
<ol style="list-style-type: decimal">
<li>Remove all instances of x, z, and f( ) from your environment so that you are starting fresh for this exercise.</li>
</ol>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="intermediate-r-programming-1.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(x)</span>
<span id="cb458-2"><a href="intermediate-r-programming-1.html#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(z)</span>
<span id="cb458-3"><a href="intermediate-r-programming-1.html#cb458-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(f)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>What happens when we run <code>f()</code>? Why?</li>
</ol>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="intermediate-r-programming-1.html#cb459-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>()</span>
<span id="cb459-2"><a href="intermediate-r-programming-1.html#cb459-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb459-3"><a href="intermediate-r-programming-1.html#cb459-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">2</span><span class="sc">*</span>x) </span>
<span id="cb459-4"><a href="intermediate-r-programming-1.html#cb459-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb459-5"><a href="intermediate-r-programming-1.html#cb459-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-6"><a href="intermediate-r-programming-1.html#cb459-6" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>() </span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>What will <code>f()</code> return? Why?</li>
</ol>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="intermediate-r-programming-1.html#cb460-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb460-2"><a href="intermediate-r-programming-1.html#cb460-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-3"><a href="intermediate-r-programming-1.html#cb460-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>()</span>
<span id="cb460-4"><a href="intermediate-r-programming-1.html#cb460-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb460-5"><a href="intermediate-r-programming-1.html#cb460-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="dv">2</span> </span>
<span id="cb460-6"><a href="intermediate-r-programming-1.html#cb460-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">2</span><span class="sc">*</span>x) </span>
<span id="cb460-7"><a href="intermediate-r-programming-1.html#cb460-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb460-8"><a href="intermediate-r-programming-1.html#cb460-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-9"><a href="intermediate-r-programming-1.html#cb460-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>() </span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>What does the final <code>y</code> call return?</li>
</ol>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="intermediate-r-programming-1.html#cb461-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb461-2"><a href="intermediate-r-programming-1.html#cb461-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-3"><a href="intermediate-r-programming-1.html#cb461-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb461-4"><a href="intermediate-r-programming-1.html#cb461-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb461-5"><a href="intermediate-r-programming-1.html#cb461-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> x<span class="sc">+</span><span class="dv">2</span> </span>
<span id="cb461-6"><a href="intermediate-r-programming-1.html#cb461-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x<span class="sc">*</span>y)</span>
<span id="cb461-7"><a href="intermediate-r-programming-1.html#cb461-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb461-8"><a href="intermediate-r-programming-1.html#cb461-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-9"><a href="intermediate-r-programming-1.html#cb461-9" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="dv">1</span>)</span>
<span id="cb461-10"><a href="intermediate-r-programming-1.html#cb461-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-11"><a href="intermediate-r-programming-1.html#cb461-11" aria-hidden="true" tabindex="-1"></a>y</span></code></pre></div>
</div>
</div>
</div>
<div id="building-a-function" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> Building a function</h2>
<p>Now that we understand the basics of functions, let’s get to work building our function to test the relationship between depth and geochemical variables in Saanich Inlet.</p>
<p>Each step will add to our growing function. <strong>Look for <code>###</code> on lines that are changed in each step.</strong></p>
<div id="step-1.-define-and-test-your-task" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> Step 1. Define and test your task</h3>
<p>The first thing we need to do is determine what code we need to perform our given task on a single set of inputs.</p>
<p>In this case, we need to</p>
<ol style="list-style-type: decimal">
<li>Subset the data <code>dat</code> to a single cruise (Let’s use Cruise 72)</li>
<li>Fit a linear model for 1 variable by depth (Let’s do oxygen)</li>
<li>Summarize the linear model</li>
<li>Extract p-values from the summary
<ul>
<li>Remember from earlier in this workshop, a “summary.lm” object is an R list object so we need to use <code>$</code> to obtain the p-values</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="intermediate-r-programming-1.html#cb462-1" aria-hidden="true" tabindex="-1"></a>dat.subset <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> <span class="dv">72</span>)</span>
<span id="cb462-2"><a href="intermediate-r-programming-1.html#cb462-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-3"><a href="intermediate-r-programming-1.html#cb462-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset<span class="sc">$</span>O2_uM <span class="sc">~</span> dat.subset<span class="sc">$</span>Depth_m)</span>
<span id="cb462-4"><a href="intermediate-r-programming-1.html#cb462-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-5"><a href="intermediate-r-programming-1.html#cb462-5" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb462-6"><a href="intermediate-r-programming-1.html#cb462-6" aria-hidden="true" tabindex="-1"></a>sum</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = dat.subset$O2_uM ~ dat.subset$Depth_m)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -46.360 -20.673  -2.353  21.741  67.887 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        158.9952    17.7699   8.947 3.64e-07 ***
## dat.subset$Depth_m  -1.0215     0.1534  -6.660 1.08e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 32.98 on 14 degrees of freedom
## Multiple R-squared:  0.7601, Adjusted R-squared:  0.7429 
## F-statistic: 44.35 on 1 and 14 DF,  p-value: 1.079e-05</code></pre>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="intermediate-r-programming-1.html#cb464-1" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb464-2"><a href="intermediate-r-programming-1.html#cb464-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-3"><a href="intermediate-r-programming-1.html#cb464-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pval)</span></code></pre></div>
<pre><code>##        (Intercept) dat.subset$Depth_m 
##       3.636103e-07       1.079146e-05</code></pre>
<p>Step 2: Turn the task into a function</p>
<p>Now, the simplest function to complete this task only needs <code>y</code> (the geochemical variable) and <code>data</code> as inputs. Notice that we need to call y within the function as <code>dat.subset[[y]]</code> in order to retrieve the data in <code>dat.subset$O2</code> instead of just the character value “O2.”</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="intermediate-r-programming-1.html#cb466-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, y){ <span class="do">###</span></span>
<span id="cb466-2"><a href="intermediate-r-programming-1.html#cb466-2" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> <span class="dv">72</span>)</span>
<span id="cb466-3"><a href="intermediate-r-programming-1.html#cb466-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-4"><a href="intermediate-r-programming-1.html#cb466-4" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y]] <span class="sc">~</span> dat.subset<span class="sc">$</span>Depth_m) <span class="do">###</span></span>
<span id="cb466-5"><a href="intermediate-r-programming-1.html#cb466-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-6"><a href="intermediate-r-programming-1.html#cb466-6" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb466-7"><a href="intermediate-r-programming-1.html#cb466-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb466-8"><a href="intermediate-r-programming-1.html#cb466-8" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb466-9"><a href="intermediate-r-programming-1.html#cb466-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-10"><a href="intermediate-r-programming-1.html#cb466-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pval)</span>
<span id="cb466-11"><a href="intermediate-r-programming-1.html#cb466-11" aria-hidden="true" tabindex="-1"></a>} <span class="do">###</span></span>
<span id="cb466-12"><a href="intermediate-r-programming-1.html#cb466-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb466-13"><a href="intermediate-r-programming-1.html#cb466-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">y=</span><span class="st">&quot;O2_uM&quot;</span>)</span></code></pre></div>
<pre><code>##        (Intercept) dat.subset$Depth_m 
##       3.636103e-07       1.079146e-05</code></pre>
<p>However, to make this function more robust (and thus, useful in other situations), let’s allow the user to change multiple inputs including the Cruise as well as x and y in the linear model.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="intermediate-r-programming-1.html#cb468-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){ <span class="do">###</span></span>
<span id="cb468-2"><a href="intermediate-r-programming-1.html#cb468-2" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise) <span class="do">###</span></span>
<span id="cb468-3"><a href="intermediate-r-programming-1.html#cb468-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-4"><a href="intermediate-r-programming-1.html#cb468-4" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y]] <span class="sc">~</span> dat.subset[[x]]) <span class="do">###</span></span>
<span id="cb468-5"><a href="intermediate-r-programming-1.html#cb468-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-6"><a href="intermediate-r-programming-1.html#cb468-6" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb468-7"><a href="intermediate-r-programming-1.html#cb468-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb468-8"><a href="intermediate-r-programming-1.html#cb468-8" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb468-9"><a href="intermediate-r-programming-1.html#cb468-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-10"><a href="intermediate-r-programming-1.html#cb468-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pval)</span>
<span id="cb468-11"><a href="intermediate-r-programming-1.html#cb468-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb468-12"><a href="intermediate-r-programming-1.html#cb468-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb468-13"><a href="intermediate-r-programming-1.html#cb468-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="st">&quot;O2_uM&quot;</span>)</span></code></pre></div>
<pre><code>##     (Intercept) dat.subset[[x]] 
##    3.636103e-07    1.079146e-05</code></pre>
<p>Importantly, we can compare the outputs of Steps 1 and 2 to verify that our function is completing the correct task.</p>
</div>
<div id="step-3-add-packages" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> Step 3: Add packages</h3>
<p>For reproducibility, you should include all necessary packages within a function. Since we are using <code>filter</code> from the tidyverse, we will start our function by requiring this package.</p>
<p>Best practices dictate that we use <code>require( )</code> within a function instead of <code>library( )</code>, which we used to load packages into our project earlier in this workshop. Both of these functions load packages into the environment. However, <code>require( )</code> outputs a warning and continues if the package is not found, whereas <code>library( )</code> issues an error that would halt the function.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="intermediate-r-programming-1.html#cb470-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb470-2"><a href="intermediate-r-programming-1.html#cb470-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse) <span class="do">###</span></span>
<span id="cb470-3"><a href="intermediate-r-programming-1.html#cb470-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb470-4"><a href="intermediate-r-programming-1.html#cb470-4" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb470-5"><a href="intermediate-r-programming-1.html#cb470-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-6"><a href="intermediate-r-programming-1.html#cb470-6" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb470-7"><a href="intermediate-r-programming-1.html#cb470-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-8"><a href="intermediate-r-programming-1.html#cb470-8" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb470-9"><a href="intermediate-r-programming-1.html#cb470-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb470-10"><a href="intermediate-r-programming-1.html#cb470-10" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb470-11"><a href="intermediate-r-programming-1.html#cb470-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-12"><a href="intermediate-r-programming-1.html#cb470-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pval)</span>
<span id="cb470-13"><a href="intermediate-r-programming-1.html#cb470-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb470-14"><a href="intermediate-r-programming-1.html#cb470-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-15"><a href="intermediate-r-programming-1.html#cb470-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="st">&quot;O2_uM&quot;</span>)</span></code></pre></div>
<pre><code>##     (Intercept) dat.subset[[x]] 
##    3.636103e-07    1.079146e-05</code></pre>
</div>
<div id="step-4-start-you-r-documentation" class="section level3" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> Step 4: Start you r documentation</h3>
<p>It’s early yet but it’s never too early to start commenting your code! Functions can get very complex and even simple functions are not particularly readable if you weren’t the one to write them (or even if you were for that matter). So, let’s let the user know what everything does!</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="intermediate-r-programming-1.html#cb472-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb472-2"><a href="intermediate-r-programming-1.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb472-3"><a href="intermediate-r-programming-1.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb472-4"><a href="intermediate-r-programming-1.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb472-5"><a href="intermediate-r-programming-1.html#cb472-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb472-6"><a href="intermediate-r-programming-1.html#cb472-6" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb472-7"><a href="intermediate-r-programming-1.html#cb472-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-8"><a href="intermediate-r-programming-1.html#cb472-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit a linear model </span></span>
<span id="cb472-9"><a href="intermediate-r-programming-1.html#cb472-9" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb472-10"><a href="intermediate-r-programming-1.html#cb472-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarize the model</span></span>
<span id="cb472-11"><a href="intermediate-r-programming-1.html#cb472-11" aria-hidden="true" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb472-12"><a href="intermediate-r-programming-1.html#cb472-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract p-values from the summary</span></span>
<span id="cb472-13"><a href="intermediate-r-programming-1.html#cb472-13" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb472-14"><a href="intermediate-r-programming-1.html#cb472-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-15"><a href="intermediate-r-programming-1.html#cb472-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print p-values to the console</span></span>
<span id="cb472-16"><a href="intermediate-r-programming-1.html#cb472-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(pval)</span>
<span id="cb472-17"><a href="intermediate-r-programming-1.html#cb472-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="step-5-loop-through-multiple-y-variables" class="section level3" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> Step 5: Loop through multiple y-variables</h3>
<p>A word of preface: For loops are not the most efficient or fastest method out there. Whenever possible, you should use <code>apply</code> functions instead of loops. However, for loops get the job done and are extremely useful if you want to run a simple function on a list of inputs.</p>
<p>A basic for loop is like so. You determine what you want to name a and b.</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="intermediate-r-programming-1.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(a <span class="cf">in</span> b){</span>
<span id="cb473-2"><a href="intermediate-r-programming-1.html#cb473-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform some task(s) on each element in b, one after the other</span></span>
<span id="cb473-3"><a href="intermediate-r-programming-1.html#cb473-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># A single element in b is represented by a</span></span>
<span id="cb473-4"><a href="intermediate-r-programming-1.html#cb473-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For example, we can loop through several years and print them in a phrase.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="intermediate-r-programming-1.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(year <span class="cf">in</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2020</span>){</span>
<span id="cb474-2"><a href="intermediate-r-programming-1.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  phrase <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;The year is&quot;</span>, year)</span>
<span id="cb474-3"><a href="intermediate-r-programming-1.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(phrase)</span>
<span id="cb474-4"><a href="intermediate-r-programming-1.html#cb474-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;The year is 2015&quot;
## [1] &quot;The year is 2016&quot;
## [1] &quot;The year is 2017&quot;
## [1] &quot;The year is 2018&quot;
## [1] &quot;The year is 2019&quot;
## [1] &quot;The year is 2020&quot;</code></pre>
<p>It doesn’t matter what we call the elements (year in example above), just as long as you use the same name within the loop (date in example below).</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="intermediate-r-programming-1.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (date <span class="cf">in</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2020</span>){</span>
<span id="cb476-2"><a href="intermediate-r-programming-1.html#cb476-2" aria-hidden="true" tabindex="-1"></a>  phrase <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;The year is&quot;</span>, date)</span>
<span id="cb476-3"><a href="intermediate-r-programming-1.html#cb476-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(phrase)</span>
<span id="cb476-4"><a href="intermediate-r-programming-1.html#cb476-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;The year is 2015&quot;
## [1] &quot;The year is 2016&quot;
## [1] &quot;The year is 2017&quot;
## [1] &quot;The year is 2018&quot;
## [1] &quot;The year is 2019&quot;
## [1] &quot;The year is 2020&quot;</code></pre>
<p>So, let’s apply a loop across 2 geochemical variables in our function. Notice that we don’t start the loop until the <code>model</code> because package loading and data sub-setting are the same for every geochemical variable we may input. There is no need to do these steps multiple times with a loop.</p>
<p>Notice that in the loop, we replace what was <code>y</code> with the name that we’ve given any single element in y, <code>y.variable</code>. We also must now provide multiple y variables as input and these are provided as a list with <code>c()</code></p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="intermediate-r-programming-1.html#cb478-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb478-2"><a href="intermediate-r-programming-1.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb478-3"><a href="intermediate-r-programming-1.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb478-4"><a href="intermediate-r-programming-1.html#cb478-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb478-5"><a href="intermediate-r-programming-1.html#cb478-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb478-6"><a href="intermediate-r-programming-1.html#cb478-6" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb478-7"><a href="intermediate-r-programming-1.html#cb478-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb478-8"><a href="intermediate-r-programming-1.html#cb478-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y </span><span class="al">###</span></span>
<span id="cb478-9"><a href="intermediate-r-programming-1.html#cb478-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb478-10"><a href="intermediate-r-programming-1.html#cb478-10" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]]) <span class="do">###</span></span>
<span id="cb478-11"><a href="intermediate-r-programming-1.html#cb478-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb478-12"><a href="intermediate-r-programming-1.html#cb478-12" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb478-13"><a href="intermediate-r-programming-1.html#cb478-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary</span></span>
<span id="cb478-14"><a href="intermediate-r-programming-1.html#cb478-14" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb478-15"><a href="intermediate-r-programming-1.html#cb478-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-16"><a href="intermediate-r-programming-1.html#cb478-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print p-values to the console</span></span>
<span id="cb478-17"><a href="intermediate-r-programming-1.html#cb478-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(pval)</span>
<span id="cb478-18"><a href="intermediate-r-programming-1.html#cb478-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb478-19"><a href="intermediate-r-programming-1.html#cb478-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb478-20"><a href="intermediate-r-programming-1.html#cb478-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-21"><a href="intermediate-r-programming-1.html#cb478-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>,<span class="st">&quot;NO3_uM&quot;</span>))</span></code></pre></div>
<pre><code>##     (Intercept) dat.subset[[x]] 
##    3.636103e-07    1.079146e-05 
##     (Intercept) dat.subset[[x]] 
##    0.0003919827    0.0740374332</code></pre>
<p>And with this added complexity, we want to check that our function is still completing its tasks correctly. So, we should compare the function’s output to the same tasks by-hand.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="intermediate-r-programming-1.html#cb480-1" aria-hidden="true" tabindex="-1"></a>dat.subset <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> <span class="dv">72</span>)</span>
<span id="cb480-2"><a href="intermediate-r-programming-1.html#cb480-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-3"><a href="intermediate-r-programming-1.html#cb480-3" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset<span class="sc">$</span>O2_uM <span class="sc">~</span> dat.subset<span class="sc">$</span>Depth_m)</span>
<span id="cb480-4"><a href="intermediate-r-programming-1.html#cb480-4" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb480-5"><a href="intermediate-r-programming-1.html#cb480-5" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb480-6"><a href="intermediate-r-programming-1.html#cb480-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pval)</span></code></pre></div>
<pre><code>##        (Intercept) dat.subset$Depth_m 
##       3.636103e-07       1.079146e-05</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="intermediate-r-programming-1.html#cb482-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset<span class="sc">$</span>NO3_uM <span class="sc">~</span> dat.subset<span class="sc">$</span>Depth_m)</span>
<span id="cb482-2"><a href="intermediate-r-programming-1.html#cb482-2" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb482-3"><a href="intermediate-r-programming-1.html#cb482-3" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb482-4"><a href="intermediate-r-programming-1.html#cb482-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pval)</span></code></pre></div>
<pre><code>##        (Intercept) dat.subset$Depth_m 
##       0.0003919827       0.0740374332</code></pre>
<div id="exercise-using-a-custom-function" class="section level4" number="6.6.4.1">
<h4><span class="header-section-number">6.6.4.1</span> Exercise: Using a custom function</h4>
<ol style="list-style-type: decimal">
<li>Apply the current <code>lm.function</code> to all the available geochemical variables in the Saanich data set. Which ones appear to be significantly correlated with depth?</li>
<li>Copy the <code>lm.function</code> and alter it to print out the models’ adjusted R-squared values instead of p-values. Be sure to run the function with inputs to make sure it works!</li>
</ol>
</div>
</div>
<div id="step-6-save-results-to-a-table" class="section level3" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> Step 6: Save results to a table</h3>
<p>Now that we can obtain linear model p-values across all our variables of interest, let’s save them to a cleanly formatted table.</p>
</div>
<div id="step-6.1-save-all-iterations-of-the-loop" class="section level3" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> Step 6.1: Save all iterations of the loop</h3>
<p>The first thing to consider is what class of data the p-values are currently being output as. We can check this from our <code>pval</code> object created above, since this object is saved in the global environment.</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="intermediate-r-programming-1.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pval)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="intermediate-r-programming-1.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(pval)</span></code></pre></div>
<pre><code>## $names
## [1] &quot;(Intercept)&quot;        &quot;dat.subset$Depth_m&quot;</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="intermediate-r-programming-1.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.vector</span>(pval)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="intermediate-r-programming-1.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(pval)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>It looks like our output is a vector of length 2 with names. If we simply try to save the output of our function to the global environment with <code>&lt;&lt;-</code>, we will only see the last iteration of the loop.</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="intermediate-r-programming-1.html#cb492-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb492-2"><a href="intermediate-r-programming-1.html#cb492-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb492-3"><a href="intermediate-r-programming-1.html#cb492-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb492-4"><a href="intermediate-r-programming-1.html#cb492-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-5"><a href="intermediate-r-programming-1.html#cb492-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb492-6"><a href="intermediate-r-programming-1.html#cb492-6" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb492-7"><a href="intermediate-r-programming-1.html#cb492-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb492-8"><a href="intermediate-r-programming-1.html#cb492-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y</span></span>
<span id="cb492-9"><a href="intermediate-r-programming-1.html#cb492-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb492-10"><a href="intermediate-r-programming-1.html#cb492-10" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb492-11"><a href="intermediate-r-programming-1.html#cb492-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb492-12"><a href="intermediate-r-programming-1.html#cb492-12" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb492-13"><a href="intermediate-r-programming-1.html#cb492-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary</span></span>
<span id="cb492-14"><a href="intermediate-r-programming-1.html#cb492-14" aria-hidden="true" tabindex="-1"></a>    pval <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>] <span class="do">###</span></span>
<span id="cb492-15"><a href="intermediate-r-programming-1.html#cb492-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-16"><a href="intermediate-r-programming-1.html#cb492-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb492-17"><a href="intermediate-r-programming-1.html#cb492-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save results to the global environment</span></span>
<span id="cb492-18"><a href="intermediate-r-programming-1.html#cb492-18" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;&lt;-</span> pval <span class="do">###</span></span>
<span id="cb492-19"><a href="intermediate-r-programming-1.html#cb492-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb492-20"><a href="intermediate-r-programming-1.html#cb492-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb492-21"><a href="intermediate-r-programming-1.html#cb492-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>, <span class="st">&quot;NO3_uM&quot;</span>))</span>
<span id="cb492-22"><a href="intermediate-r-programming-1.html#cb492-22" aria-hidden="true" tabindex="-1"></a>pval</span></code></pre></div>
<pre><code>##     (Intercept) dat.subset[[x]] 
##    0.0003919827    0.0740374332</code></pre>
<p>So, we need to create a list object to hold each iteration’s result and then <code>rbind</code> (row bind) them into a single results object</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="intermediate-r-programming-1.html#cb494-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb494-2"><a href="intermediate-r-programming-1.html#cb494-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb494-3"><a href="intermediate-r-programming-1.html#cb494-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb494-4"><a href="intermediate-r-programming-1.html#cb494-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb494-5"><a href="intermediate-r-programming-1.html#cb494-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to hold results</span></span>
<span id="cb494-6"><a href="intermediate-r-programming-1.html#cb494-6" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">=</span> <span class="fu">list</span>() <span class="do">###</span></span>
<span id="cb494-7"><a href="intermediate-r-programming-1.html#cb494-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-8"><a href="intermediate-r-programming-1.html#cb494-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb494-9"><a href="intermediate-r-programming-1.html#cb494-9" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb494-10"><a href="intermediate-r-programming-1.html#cb494-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb494-11"><a href="intermediate-r-programming-1.html#cb494-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y</span></span>
<span id="cb494-12"><a href="intermediate-r-programming-1.html#cb494-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb494-13"><a href="intermediate-r-programming-1.html#cb494-13" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb494-14"><a href="intermediate-r-programming-1.html#cb494-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb494-15"><a href="intermediate-r-programming-1.html#cb494-15" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb494-16"><a href="intermediate-r-programming-1.html#cb494-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary. Save into the pval list based on the y.variable name</span></span>
<span id="cb494-17"><a href="intermediate-r-programming-1.html#cb494-17" aria-hidden="true" tabindex="-1"></a>    pval[[y.variable]] <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>] <span class="do">###</span></span>
<span id="cb494-18"><a href="intermediate-r-programming-1.html#cb494-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-19"><a href="intermediate-r-programming-1.html#cb494-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb494-20"><a href="intermediate-r-programming-1.html#cb494-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all results into 1 single object</span></span>
<span id="cb494-21"><a href="intermediate-r-programming-1.html#cb494-21" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;&lt;-</span> <span class="fu">do.call</span>(rbind,pval) <span class="do">###</span></span>
<span id="cb494-22"><a href="intermediate-r-programming-1.html#cb494-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb494-23"><a href="intermediate-r-programming-1.html#cb494-23" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb494-24"><a href="intermediate-r-programming-1.html#cb494-24" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>, <span class="st">&quot;NO3_uM&quot;</span>))</span>
<span id="cb494-25"><a href="intermediate-r-programming-1.html#cb494-25" aria-hidden="true" tabindex="-1"></a>pval</span></code></pre></div>
<pre><code>##         (Intercept) dat.subset[[x]]
## O2_uM  3.636103e-07    1.079146e-05
## NO3_uM 3.919827e-04    7.403743e-02</code></pre>
</div>
<div id="step-6.2-beautify-the-output" class="section level3" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> Step 6.2 Beautify the output</h3>
<p><em>Column names</em></p>
<p>Now we have all the results in table, but the column names aren’t very informative. So, we can rename the columns with <code>rename_at</code>.</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="intermediate-r-programming-1.html#cb496-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb496-2"><a href="intermediate-r-programming-1.html#cb496-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb496-3"><a href="intermediate-r-programming-1.html#cb496-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb496-4"><a href="intermediate-r-programming-1.html#cb496-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb496-5"><a href="intermediate-r-programming-1.html#cb496-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to hold results</span></span>
<span id="cb496-6"><a href="intermediate-r-programming-1.html#cb496-6" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb496-7"><a href="intermediate-r-programming-1.html#cb496-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-8"><a href="intermediate-r-programming-1.html#cb496-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb496-9"><a href="intermediate-r-programming-1.html#cb496-9" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb496-10"><a href="intermediate-r-programming-1.html#cb496-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb496-11"><a href="intermediate-r-programming-1.html#cb496-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y</span></span>
<span id="cb496-12"><a href="intermediate-r-programming-1.html#cb496-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb496-13"><a href="intermediate-r-programming-1.html#cb496-13" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb496-14"><a href="intermediate-r-programming-1.html#cb496-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb496-15"><a href="intermediate-r-programming-1.html#cb496-15" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb496-16"><a href="intermediate-r-programming-1.html#cb496-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary. Save into the pval list based on the y.variable name</span></span>
<span id="cb496-17"><a href="intermediate-r-programming-1.html#cb496-17" aria-hidden="true" tabindex="-1"></a>    pval[[y.variable]] <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb496-18"><a href="intermediate-r-programming-1.html#cb496-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb496-19"><a href="intermediate-r-programming-1.html#cb496-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb496-20"><a href="intermediate-r-programming-1.html#cb496-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all results into 1 single object</span></span>
<span id="cb496-21"><a href="intermediate-r-programming-1.html#cb496-21" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,pval) <span class="do">### No longer saved to global environment</span></span>
<span id="cb496-22"><a href="intermediate-r-programming-1.html#cb496-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb496-23"><a href="intermediate-r-programming-1.html#cb496-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb496-24"><a href="intermediate-r-programming-1.html#cb496-24" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;&lt;-</span> pval <span class="sc">%&gt;%</span> <span class="do">###</span></span>
<span id="cb496-25"><a href="intermediate-r-programming-1.html#cb496-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">colnames</span>(pval)), <span class="sc">~</span><span class="fu">c</span>(<span class="st">&quot;Intercept.p&quot;</span>, <span class="st">&quot;Depth.p&quot;</span>)) <span class="do">###</span></span>
<span id="cb496-26"><a href="intermediate-r-programming-1.html#cb496-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb496-27"><a href="intermediate-r-programming-1.html#cb496-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb496-28"><a href="intermediate-r-programming-1.html#cb496-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>, <span class="st">&quot;NO3_uM&quot;</span>))</span></code></pre></div>
<pre><code>## Error in UseMethod(&quot;tbl_vars&quot;): no applicable method for &#39;tbl_vars&#39; applied to an object of class &quot;c(&#39;matrix&#39;, &#39;array&#39;, &#39;double&#39;, &#39;numeric&#39;)&quot;</code></pre>
<p>However, our data output is current a matrix and the tidyverse only works on data frames. Thus, we need to reformat <code>pval</code>.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="intermediate-r-programming-1.html#cb498-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb498-2"><a href="intermediate-r-programming-1.html#cb498-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb498-3"><a href="intermediate-r-programming-1.html#cb498-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb498-4"><a href="intermediate-r-programming-1.html#cb498-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-5"><a href="intermediate-r-programming-1.html#cb498-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to hold results</span></span>
<span id="cb498-6"><a href="intermediate-r-programming-1.html#cb498-6" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb498-7"><a href="intermediate-r-programming-1.html#cb498-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-8"><a href="intermediate-r-programming-1.html#cb498-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb498-9"><a href="intermediate-r-programming-1.html#cb498-9" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb498-10"><a href="intermediate-r-programming-1.html#cb498-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-11"><a href="intermediate-r-programming-1.html#cb498-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y</span></span>
<span id="cb498-12"><a href="intermediate-r-programming-1.html#cb498-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb498-13"><a href="intermediate-r-programming-1.html#cb498-13" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb498-14"><a href="intermediate-r-programming-1.html#cb498-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb498-15"><a href="intermediate-r-programming-1.html#cb498-15" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb498-16"><a href="intermediate-r-programming-1.html#cb498-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary. Save into the pval list based on the y.variable name</span></span>
<span id="cb498-17"><a href="intermediate-r-programming-1.html#cb498-17" aria-hidden="true" tabindex="-1"></a>    pval[[y.variable]] <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb498-18"><a href="intermediate-r-programming-1.html#cb498-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-19"><a href="intermediate-r-programming-1.html#cb498-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb498-20"><a href="intermediate-r-programming-1.html#cb498-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all results into 1 single object</span></span>
<span id="cb498-21"><a href="intermediate-r-programming-1.html#cb498-21" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind,pval)) <span class="do">###</span></span>
<span id="cb498-22"><a href="intermediate-r-programming-1.html#cb498-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb498-23"><a href="intermediate-r-programming-1.html#cb498-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb498-24"><a href="intermediate-r-programming-1.html#cb498-24" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;&lt;-</span> pval <span class="sc">%&gt;%</span></span>
<span id="cb498-25"><a href="intermediate-r-programming-1.html#cb498-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">colnames</span>(pval)), <span class="sc">~</span><span class="fu">c</span>(<span class="st">&quot;Intercept.p&quot;</span>, <span class="st">&quot;Depth.p&quot;</span>))</span>
<span id="cb498-26"><a href="intermediate-r-programming-1.html#cb498-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb498-27"><a href="intermediate-r-programming-1.html#cb498-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb498-28"><a href="intermediate-r-programming-1.html#cb498-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>, <span class="st">&quot;NO3_uM&quot;</span>))</span>
<span id="cb498-29"><a href="intermediate-r-programming-1.html#cb498-29" aria-hidden="true" tabindex="-1"></a>pval</span></code></pre></div>
<pre><code>##         Intercept.p      Depth.p
## O2_uM  3.636103e-07 1.079146e-05
## NO3_uM 3.919827e-04 7.403743e-02</code></pre>
<p><em>Dynamic naming</em></p>
<p>Let’s go one step further and make all of the names dynamic, <em>i.e.</em> based on the function’s inputs, so that we don’t need to change the function if we input a different x-variable.</p>
<p>Note how we can create a dynamic name using data from the <code>pval</code> output (example, col1) or from the <code>function</code> inputs (examples, col2 and table.name).</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="intermediate-r-programming-1.html#cb500-1" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb500-2"><a href="intermediate-r-programming-1.html#cb500-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb500-3"><a href="intermediate-r-programming-1.html#cb500-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb500-4"><a href="intermediate-r-programming-1.html#cb500-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-5"><a href="intermediate-r-programming-1.html#cb500-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to hold results</span></span>
<span id="cb500-6"><a href="intermediate-r-programming-1.html#cb500-6" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb500-7"><a href="intermediate-r-programming-1.html#cb500-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-8"><a href="intermediate-r-programming-1.html#cb500-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb500-9"><a href="intermediate-r-programming-1.html#cb500-9" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb500-10"><a href="intermediate-r-programming-1.html#cb500-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-11"><a href="intermediate-r-programming-1.html#cb500-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y</span></span>
<span id="cb500-12"><a href="intermediate-r-programming-1.html#cb500-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb500-13"><a href="intermediate-r-programming-1.html#cb500-13" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb500-14"><a href="intermediate-r-programming-1.html#cb500-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb500-15"><a href="intermediate-r-programming-1.html#cb500-15" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb500-16"><a href="intermediate-r-programming-1.html#cb500-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary. Save into the pval list based on the y.variable name</span></span>
<span id="cb500-17"><a href="intermediate-r-programming-1.html#cb500-17" aria-hidden="true" tabindex="-1"></a>    pval[[y.variable]] <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb500-18"><a href="intermediate-r-programming-1.html#cb500-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-19"><a href="intermediate-r-programming-1.html#cb500-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb500-20"><a href="intermediate-r-programming-1.html#cb500-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all results into 1 single object</span></span>
<span id="cb500-21"><a href="intermediate-r-programming-1.html#cb500-21" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind,pval))</span>
<span id="cb500-22"><a href="intermediate-r-programming-1.html#cb500-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-23"><a href="intermediate-r-programming-1.html#cb500-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dynamic column names</span></span>
<span id="cb500-24"><a href="intermediate-r-programming-1.html#cb500-24" aria-hidden="true" tabindex="-1"></a>  col1 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">colnames</span>(pval)[<span class="dv">1</span>], <span class="st">&quot;p&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>) <span class="do">###</span></span>
<span id="cb500-25"><a href="intermediate-r-programming-1.html#cb500-25" aria-hidden="true" tabindex="-1"></a>  col2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(x, <span class="st">&quot;p&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>) <span class="do">###</span></span>
<span id="cb500-26"><a href="intermediate-r-programming-1.html#cb500-26" aria-hidden="true" tabindex="-1"></a>  table.name <span class="ot">&lt;-</span> <span class="fu">paste</span>(x, <span class="st">&quot;lm_pvals&quot;</span>, <span class="at">sep=</span><span class="st">&quot;_&quot;</span>) <span class="do">###</span></span>
<span id="cb500-27"><a href="intermediate-r-programming-1.html#cb500-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb500-28"><a href="intermediate-r-programming-1.html#cb500-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb500-29"><a href="intermediate-r-programming-1.html#cb500-29" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> pval <span class="sc">%&gt;%</span> <span class="do">###</span></span>
<span id="cb500-30"><a href="intermediate-r-programming-1.html#cb500-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">colnames</span>(pval)), <span class="sc">~</span><span class="fu">c</span>(col1, col2)) <span class="do">###</span></span>
<span id="cb500-31"><a href="intermediate-r-programming-1.html#cb500-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename output table and save to environment</span></span>
<span id="cb500-32"><a href="intermediate-r-programming-1.html#cb500-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(table.name, pval, <span class="at">envir =</span> .GlobalEnv) <span class="do">###</span></span>
<span id="cb500-33"><a href="intermediate-r-programming-1.html#cb500-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb500-34"><a href="intermediate-r-programming-1.html#cb500-34" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb500-35"><a href="intermediate-r-programming-1.html#cb500-35" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>, <span class="st">&quot;NO3_uM&quot;</span>))</span>
<span id="cb500-36"><a href="intermediate-r-programming-1.html#cb500-36" aria-hidden="true" tabindex="-1"></a>Depth_m_lm_pvals</span></code></pre></div>
<pre><code>##        (Intercept).p    Depth_m.p
## O2_uM   3.636103e-07 1.079146e-05
## NO3_uM  3.919827e-04 7.403743e-02</code></pre>
<p>Now we have a very robust function that we can use to fit linear models across any variables in our data set!</p>
</div>
<div id="step-7-complete-documentation" class="section level3" number="6.6.8">
<h3><span class="header-section-number">6.6.8</span> Step 7: Complete documentation</h3>
<p>The final step in any analysis, but especially in functions, is to go over your documentation and commenting to make sure everything is clear. Best practices are to include an introduction to the function that includes the purpose, license, inputs, and outputs.</p>
<p>Since functions can get quite long, it is also best practices to save them in separate R scripts. So our <code>lm.function</code> would be in a file <code>lm.function.R</code> that contains</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="intermediate-r-programming-1.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb502-2"><a href="intermediate-r-programming-1.html#cb502-2" aria-hidden="true" tabindex="-1"></a><span class="st">lm.function: Estimates p-values from linear models of geochemical data from a single Saanich Inlet cruise</span></span>
<span id="cb502-3"><a href="intermediate-r-programming-1.html#cb502-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-4"><a href="intermediate-r-programming-1.html#cb502-4" aria-hidden="true" tabindex="-1"></a><span class="st">Kim Dill-Mcfarland</span></span>
<span id="cb502-5"><a href="intermediate-r-programming-1.html#cb502-5" aria-hidden="true" tabindex="-1"></a><span class="st">kadm@mail.ubc.ca</span></span>
<span id="cb502-6"><a href="intermediate-r-programming-1.html#cb502-6" aria-hidden="true" tabindex="-1"></a><span class="st">University of British Columbia</span></span>
<span id="cb502-7"><a href="intermediate-r-programming-1.html#cb502-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-8"><a href="intermediate-r-programming-1.html#cb502-8" aria-hidden="true" tabindex="-1"></a><span class="st">LICENSE</span></span>
<span id="cb502-9"><a href="intermediate-r-programming-1.html#cb502-9" aria-hidden="true" tabindex="-1"></a><span class="st">Copyright (C) 2018 Kim Dill-McFarland</span></span>
<span id="cb502-10"><a href="intermediate-r-programming-1.html#cb502-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-11"><a href="intermediate-r-programming-1.html#cb502-11" aria-hidden="true" tabindex="-1"></a><span class="st">This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</span></span>
<span id="cb502-12"><a href="intermediate-r-programming-1.html#cb502-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-13"><a href="intermediate-r-programming-1.html#cb502-13" aria-hidden="true" tabindex="-1"></a><span class="st">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</span></span>
<span id="cb502-14"><a href="intermediate-r-programming-1.html#cb502-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-15"><a href="intermediate-r-programming-1.html#cb502-15" aria-hidden="true" tabindex="-1"></a><span class="st">You should have received a copy of the GNU General Public License along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></span>
<span id="cb502-16"><a href="intermediate-r-programming-1.html#cb502-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-17"><a href="intermediate-r-programming-1.html#cb502-17" aria-hidden="true" tabindex="-1"></a><span class="st">INPUTS</span></span>
<span id="cb502-18"><a href="intermediate-r-programming-1.html#cb502-18" aria-hidden="true" tabindex="-1"></a><span class="st">data: a data.frame or tibble containing variables of interest</span></span>
<span id="cb502-19"><a href="intermediate-r-programming-1.html#cb502-19" aria-hidden="true" tabindex="-1"></a><span class="st">cruise: Cruise # for subsetting data, 18-100 available in current data</span></span>
<span id="cb502-20"><a href="intermediate-r-programming-1.html#cb502-20" aria-hidden="true" tabindex="-1"></a><span class="st">x: x-variable in lm, for example &#39;Depth_m&#39;</span></span>
<span id="cb502-21"><a href="intermediate-r-programming-1.html#cb502-21" aria-hidden="true" tabindex="-1"></a><span class="st">y: y-variables in lm, for example c(&#39;O2_uM&#39;, &#39;NO3_uM&#39;)</span></span>
<span id="cb502-22"><a href="intermediate-r-programming-1.html#cb502-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-23"><a href="intermediate-r-programming-1.html#cb502-23" aria-hidden="true" tabindex="-1"></a><span class="st">OUTPUTS</span></span>
<span id="cb502-24"><a href="intermediate-r-programming-1.html#cb502-24" aria-hidden="true" tabindex="-1"></a><span class="st">data frame of p-values named [x]_lm_pvals</span></span>
<span id="cb502-25"><a href="intermediate-r-programming-1.html#cb502-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb502-26"><a href="intermediate-r-programming-1.html#cb502-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-27"><a href="intermediate-r-programming-1.html#cb502-27" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb502-28"><a href="intermediate-r-programming-1.html#cb502-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load necessary packages</span></span>
<span id="cb502-29"><a href="intermediate-r-programming-1.html#cb502-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(tidyverse)</span>
<span id="cb502-30"><a href="intermediate-r-programming-1.html#cb502-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb502-31"><a href="intermediate-r-programming-1.html#cb502-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to hold results</span></span>
<span id="cb502-32"><a href="intermediate-r-programming-1.html#cb502-32" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb502-33"><a href="intermediate-r-programming-1.html#cb502-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-34"><a href="intermediate-r-programming-1.html#cb502-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the data to the cruise of interest</span></span>
<span id="cb502-35"><a href="intermediate-r-programming-1.html#cb502-35" aria-hidden="true" tabindex="-1"></a>  dat.subset <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Cruise <span class="sc">==</span> cruise)</span>
<span id="cb502-36"><a href="intermediate-r-programming-1.html#cb502-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb502-37"><a href="intermediate-r-programming-1.html#cb502-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(y.variable <span class="cf">in</span> y){ <span class="co"># Loop through all variables provided in y</span></span>
<span id="cb502-38"><a href="intermediate-r-programming-1.html#cb502-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a linear model </span></span>
<span id="cb502-39"><a href="intermediate-r-programming-1.html#cb502-39" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(dat.subset[[y.variable]] <span class="sc">~</span> dat.subset[[x]])</span>
<span id="cb502-40"><a href="intermediate-r-programming-1.html#cb502-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Summarize the model</span></span>
<span id="cb502-41"><a href="intermediate-r-programming-1.html#cb502-41" aria-hidden="true" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb502-42"><a href="intermediate-r-programming-1.html#cb502-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract p-values from the summary. Save into the pval list based on the y.variable name</span></span>
<span id="cb502-43"><a href="intermediate-r-programming-1.html#cb502-43" aria-hidden="true" tabindex="-1"></a>    pval[[y.variable]] <span class="ot">&lt;-</span> sum<span class="sc">$</span>coefficients[,<span class="st">&quot;Pr(&gt;|t|)&quot;</span>]</span>
<span id="cb502-44"><a href="intermediate-r-programming-1.html#cb502-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb502-45"><a href="intermediate-r-programming-1.html#cb502-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb502-46"><a href="intermediate-r-programming-1.html#cb502-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bind all results into 1 single object</span></span>
<span id="cb502-47"><a href="intermediate-r-programming-1.html#cb502-47" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind,pval))</span>
<span id="cb502-48"><a href="intermediate-r-programming-1.html#cb502-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb502-49"><a href="intermediate-r-programming-1.html#cb502-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dynamic column names</span></span>
<span id="cb502-50"><a href="intermediate-r-programming-1.html#cb502-50" aria-hidden="true" tabindex="-1"></a>  col1 <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">colnames</span>(pval)[<span class="dv">1</span>], <span class="st">&quot;p&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb502-51"><a href="intermediate-r-programming-1.html#cb502-51" aria-hidden="true" tabindex="-1"></a>  col2 <span class="ot">&lt;-</span> <span class="fu">paste</span>(x, <span class="st">&quot;p&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb502-52"><a href="intermediate-r-programming-1.html#cb502-52" aria-hidden="true" tabindex="-1"></a>  table.name <span class="ot">&lt;-</span> <span class="fu">paste</span>(x, <span class="st">&quot;lm_pvals&quot;</span>, <span class="at">sep=</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb502-53"><a href="intermediate-r-programming-1.html#cb502-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb502-54"><a href="intermediate-r-programming-1.html#cb502-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb502-55"><a href="intermediate-r-programming-1.html#cb502-55" aria-hidden="true" tabindex="-1"></a>  pval <span class="ot">&lt;-</span> pval <span class="sc">%&gt;%</span> <span class="do">###</span></span>
<span id="cb502-56"><a href="intermediate-r-programming-1.html#cb502-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename_at</span>(<span class="fu">vars</span>(<span class="fu">colnames</span>(pval)), <span class="sc">~</span><span class="fu">c</span>(col1, col2))</span>
<span id="cb502-57"><a href="intermediate-r-programming-1.html#cb502-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename output table and save to environment</span></span>
<span id="cb502-58"><a href="intermediate-r-programming-1.html#cb502-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(table.name, pval, <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb502-59"><a href="intermediate-r-programming-1.html#cb502-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>And you could load this function into any project with</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="intermediate-r-programming-1.html#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="co">#source(&quot;lm.function.R&quot;)</span></span></code></pre></div>
<p>Also, you should share your function with the world! Consider posting on GitHub or another open source site. You’d be surprised how many people might find your function useful as-is or as a starting off point to customize for their own needs.</p>
<div id="exercise-using-a-dynamic-custom-function" class="section level4" number="6.6.8.1">
<h4><span class="header-section-number">6.6.8.1</span> Exercise: Using a dynamic custom function</h4>
<ol style="list-style-type: decimal">
<li>Using our final <code>lm.function</code>, determine the linear fits for all geochemical variables for Cruise 12.</li>
<li>Choose a different x variable and determine if any of the Saanich geochemical variables correlate with it.</li>
</ol>
</div>
<div id="challenge-exercise" class="section level4" number="6.6.8.2">
<h4><span class="header-section-number">6.6.8.2</span> Challenge exercise:</h4>
<p>You may not have time in this workshop to complete these challenging exercises. However, we encourage you to complete them on your own to test your knowledge of functions and improve your coding skills!</p>
<ol style="list-style-type: decimal">
<li>How would you alter <code>lm.function</code> to accept sub-setting to multiple cruise #s? Hint: Think about using <code>%in%</code> when filtering the data.</li>
<li>How would you alter <code>lm.function</code> to output FDR corrected p-values?</li>
</ol>
</div>
</div>
</div>
<div id="packages" class="section level2" number="6.7">
<h2><span class="header-section-number">6.7</span> Packages</h2>
<p>Base R, in and of itself, is a pretty basic statistical program. What makes R so powerful (and popular) is the ability to load custom packages relevant to a wide range of data types and analyses. You have already seen the utility of packages such as the tidyverse in this and other workshops.</p>
<p>But why code your own package?</p>
<p>Practically speaking, creating reproducible functions in self-contained R scripts is sufficient to meet most (if not all) of your analysis needs. We are certainly not suggesting that you wrap <em>all</em> of your R code into packages! However, there are a number of advantages to turning your code into an R package.</p>
<ul>
<li>Creating a package helps you improve your code and documentation</li>
<li>Packages facilitate disseminate of your code to your collaborators, colleagues, and others in your field</li>
<li>Sharing packages contributes to the continuously evolving open source community</li>
<li>Publicly sharing packages (like CRAN or GitHub) builds your recognition in the community and adds citeable value to your CV</li>
</ul>
<p>But there are also certain challenges in creating a package such as:</p>
<ul>
<li>rigorous quality checks to submit a package on central repositories like <a href="https://cran.r-project.org/">CRAN</a></li>
<li>the need to continuously resolve bugs and other maintenance work</li>
<li>the requirement to continuously roll out new updates for continued hosting on CRAN (or else the package is orphaned)</li>
</ul>
<p>So, the utility of packages is best served by functions that you use multiple times in multiple places and/or that you would like to share with others. Thus, functions in packages should be <strong>as general as possible</strong> so that they are <strong>applicable to a wide range of problems</strong>.</p>
<p>Our <code>lm.function</code> does not necessarily meet these requirements as the data sub-setting set is specific to to our Saanich data set cruises. However, as an example, let’s turn this function into a package!</p>
</div>
<div id="creating-a-package-project" class="section level2" number="6.8">
<h2><span class="header-section-number">6.8</span> Creating a package project</h2>
<p>Fortunately, R has a package for creating packages! The <code>devtools</code> package provides all that you need to turn your code into a package.</p>
<p>To begin, create a new project in a new directory in your workshop directory. “File” &gt; “New Project” &gt; “New Directory” &gt; “R package” and name it “testPackage.”</p>
<p>You will be automatically provided with some files and directories to show you how a package <em>must</em> be organized including:</p>
<ul>
<li><strong>DESCRIPTION</strong>: text file containing the basic description of your package</li>
<li><strong>R/</strong>: directory for R scripts</li>
<li><strong>man/</strong>: directory for help files</li>
<li><strong>NAMESPACE</strong>: context for looking up the value of an object associated with a name (more on this later)</li>
</ul>
<p>To start, your package is populated with a toy ‘Hello, world!’ example.</p>
<div id="description" class="section level3" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> Description</h3>
<p>Open the DESCRIPTION file in a text editor or RStudio and update it with information relevant to this package. For example, mine would be:</p>
<pre><code>Package: testPackage
Type: Package
Title: Saanich Inlet Analyses
Version: 0.1.0
Author: Kim Dill-McFarland
Maintainer: Kim Dill-McFarland &lt;kadm@mail.ubc.ca&gt;
Description: Functions to analyze longitudinal geochemical data from Saanich Inlet. In particular, applying analyses across multiple geochemical variables and printing relevant outputs to tables.
License: GPL-2
Encoding: UTF-8
LazyData: true</code></pre>
<p>These are the required fields but you could include a number of additional metadata terms as needed. To see examples, go to your Packages tab (lower right quadrant of RStudio) and click on any package. You will see the first thing listed is the ‘DESCRIPTION file’ like the one you’ve made here.</p>
</div>
<div id="r" class="section level3" number="6.8.2">
<h3><span class="header-section-number">6.8.2</span> R/</h3>
<p>This is where your actual R code goes. It is generally a bad idea to put all functions into the same R file. However, it is also not necessary to use a separate R file for each individual function. Oftentimes, several functions are naturally connected and/or related and can, therefore, live in the same file.</p>
<p>We only have 1 function for our test example so let’s copy our <code>lm.function.R</code> file into <code>R/</code>. We can also delete all the introductory text now that we’ll be incorporating this function into a package.</p>
</div>
<div id="man" class="section level3" number="6.8.3">
<h3><span class="header-section-number">6.8.3</span> man/</h3>
<p>This is where all your help files go, including the help page, manual, and vignette files. These files will be automatically created as be continue to develop our package. For example, the help page file <code>.Rd</code> will be created once we update our imports and exports below.</p>
</div>
<div id="namespace" class="section level3" number="6.8.4">
<h3><span class="header-section-number">6.8.4</span> Namespace</h3>
<p>The namespace of your package is a pretty advanced topic that is pretty useless if you’re creating a package just for yourself. However, it is required for publicly hosted packages.</p>
<p>Basically, the namespace is what it is: a space for names. It determines where R looks for objects (like functions) so that your package does not interfere with other packages and vice versa. You’ve actually already encountered a namespace issue when you loaded the tidyverse, because dplyr contains functions with the same names as those in another package, stats.</p>
<pre><code>── Conflicts ──────────────────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
<p>So, it is best to avoid overlap in function names. However, with so many packages out there, it is difficult to be 100% sure that you’ve achieved 0% overlap. Thus, the NAMESPACE file.</p>
<p>There are two parts of the namespace: imports and exports.</p>
<ul>
<li><strong>Imports</strong>: how a function in your package finds a function in another package</li>
<li><strong>Exports</strong>: packages available outside of your package
<ul>
<li>Fewer exports is preferred as it minimizes the potential for conflicts with other packages</li>
</ul></li>
</ul>
<p>You start with the following and <em>should</em> not try to fill out the NAMESPACE file by-hand.</p>
<pre><code>exportPattern(&quot;^[[:alpha:]]+&quot;)</code></pre>
</div>
<div id="adding-imports-and-exports" class="section level3" number="6.8.5">
<h3><span class="header-section-number">6.8.5</span> Adding imports and exports</h3>
<p>Instead, we can use <code>devtools</code> to automatically populate NAMESPACE and help page files.</p>
<p>We know that our <code>lm.function</code> uses the <code>filter</code> function from the tidyverse (from the <code>dplyr</code> package specifically). Thus, we need to add the import of this package to our DESCRIPTION file. You simply add the following to the end of the file and save it. Then, we also delete the <code>require()</code> line from our function.</p>
<pre><code>Imports: dplyr</code></pre>
<p>This, however, will only tell R that our package depends on <code>dplyr</code>. We still need to state which functions we need from this package. This is where the NAMESPACE comes into play. But again, we do not want to try to fill out this file by-hand.</p>
<p>Instead, we can use <code>document</code> (aka <code>roxygen2</code>) from <code>devtools</code> to fill out the file for us. To do this, we add special comments to <code>lm.function.R</code>. These special comments have the syntax <code>#'</code> and would be the following for <code>lm.function</code>.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="intermediate-r-programming-1.html#cb508-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Linear models across multiple variables</span></span>
<span id="cb508-2"><a href="intermediate-r-programming-1.html#cb508-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb508-3"><a href="intermediate-r-programming-1.html#cb508-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Estimates p-values from linear models of geochemical data from a single Saanich Inlet cruise</span></span>
<span id="cb508-4"><a href="intermediate-r-programming-1.html#cb508-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb508-5"><a href="intermediate-r-programming-1.html#cb508-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param data data frame</span></span>
<span id="cb508-6"><a href="intermediate-r-programming-1.html#cb508-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cruise subsetting variable (numeric)</span></span>
<span id="cb508-7"><a href="intermediate-r-programming-1.html#cb508-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x independent variable in linear model (only singular accepted)</span></span>
<span id="cb508-8"><a href="intermediate-r-programming-1.html#cb508-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y dependent variable in linear model (list accepted)</span></span>
<span id="cb508-9"><a href="intermediate-r-programming-1.html#cb508-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return a p-value table</span></span>
<span id="cb508-10"><a href="intermediate-r-programming-1.html#cb508-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb508-11"><a href="intermediate-r-programming-1.html#cb508-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom dplyr filter</span></span>
<span id="cb508-12"><a href="intermediate-r-programming-1.html#cb508-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb508-13"><a href="intermediate-r-programming-1.html#cb508-13" aria-hidden="true" tabindex="-1"></a>lm.function <span class="ot">&lt;-</span> <span class="cf">function</span>(data, cruise, x, y){</span>
<span id="cb508-14"><a href="intermediate-r-programming-1.html#cb508-14" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb508-15"><a href="intermediate-r-programming-1.html#cb508-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The first line of the comments specifies the title of the help page and should, thus, be brief. The second paragraph is a short description of what the function does. All other paragraphs will be shown in the <em>Details</em> section of the help page by default. We then document the arguments (<code>@param</code>) and what the function returns (<code>@return</code>). All of these inputs contribute to the automatically generated help page in <code>man/</code>.</p>
<p>The last part is finally stating which functions we need from what package (<code>@importFrom</code>) and what to export (<em>e.g.</em> our function). These inputs impact the NAMESPACE.</p>
<p>Once we have properly documented the function, we can create the help pages and update the NAMESPACE file by running the following. <em>BEFORE</em> doing so, also delete the example ‘Hello, world!’ files.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="intermediate-r-programming-1.html#cb509-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span></code></pre></div>
<pre><code>Updating testPackage documentation
Loading testPackage
Updating roxygen version in /Users/kim/GitHub/workshops_data_science/intermediate_R/testPackage/DESCRIPTION
Writing NAMESPACE
Writing NAMESPACE</code></pre>
<p>The same result can also be achieved directly from the menu bar with Build &gt; Document.</p>
<p>If we open NAMESPACE, we will see that it has been updated.</p>
<pre><code># Generated by roxygen2: do not edit by hand

export(lm.function)
importFrom(dplyr,filter)</code></pre>
<p>As has the help page</p>
<pre><code>% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/lm.function.R
\name{lm.function}
\alias{lm.function}
\title{Linear models across multiple variables}
\usage{
lm.function(data, cruise, x, y)
}
\arguments{
\item{data}{data frame}

\item{cruise}{subsetting variable (numeric)}

\item{x}{independent variable in linear model (only singular accepted)}

\item{y}{dependent variable in linear model (list accepted)}
}
\value{
a p-value table
}
\description{
Estimates p-values from linear models of geochemical data from a single Saanich Inlet cruise
}</code></pre>
</div>
<div id="test-your-package" class="section level3" number="6.8.6">
<h3><span class="header-section-number">6.8.6</span> Test your package</h3>
<p>Now we can finally load the package.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="intermediate-r-programming-1.html#cb513-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>()</span></code></pre></div>
<p>The same result can be achieved directly from the menu bar with Build &gt; Load All</p>
<p>And then test out new function! Since we are now working in the package project, we should reload our data.</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="intermediate-r-programming-1.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb514-2"><a href="intermediate-r-programming-1.html#cb514-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-3"><a href="intermediate-r-programming-1.html#cb514-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file=</span><span class="st">&quot;../data/Saanich_Data_clean.csv&quot;</span>,</span>
<span id="cb514-4"><a href="intermediate-r-programming-1.html#cb514-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">col_names=</span><span class="cn">TRUE</span>,</span>
<span id="cb514-5"><a href="intermediate-r-programming-1.html#cb514-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">na=</span><span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;NAN&quot;</span>, <span class="st">&quot;ND&quot;</span>))</span>
<span id="cb514-6"><a href="intermediate-r-programming-1.html#cb514-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb514-7"><a href="intermediate-r-programming-1.html#cb514-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.function</span>(<span class="at">data=</span>dat, <span class="at">cruise=</span><span class="dv">72</span>, <span class="at">x=</span><span class="st">&quot;Depth_m&quot;</span>, <span class="at">y=</span><span class="fu">c</span>(<span class="st">&quot;O2_uM&quot;</span>, <span class="st">&quot;NO3_uM&quot;</span>))</span>
<span id="cb514-8"><a href="intermediate-r-programming-1.html#cb514-8" aria-hidden="true" tabindex="-1"></a>Depth_lm_pvals</span></code></pre></div>
</div>
<div id="test-your-package-again" class="section level3" number="6.8.7">
<h3><span class="header-section-number">6.8.7</span> Test your package again</h3>
<p>Now that you know your package works locally on your computer, you can check if it will perform well globally.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="intermediate-r-programming-1.html#cb515-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span></code></pre></div>
<pre><code>R CMD check results
0 errors | 0 warnings | 1 note 
checking R code for possible problems ... NOTE
lm.function: no visible global function definition for ‘%&gt;%’
lm.function: no visible binding for global variable ‘Cruise’
lm.function: no visible global function definition for ‘lm’
lm.function: no visible global function definition for ‘rename_at’
lm.function: no visible global function definition for ‘vars’
Undefined global functions or variables:
  %&gt;% Cruise lm rename_at vars
Consider adding
  importFrom(&quot;stats&quot;, &quot;lm&quot;)
to your NAMESPACE file.

Found the following assignments to the global environment:
File ‘testPackage/R/lm.function.R’:
  assign(table.name, pval, envir = .GlobalEnv)</code></pre>
<p>If you then wanted to <a href="https://cran.r-project.org/submit.html">upload to CRAN</a> or <a href="https://www.bioconductor.org/developers/package-submission/">to Bioconductor</a>, you would need to resolve the issues listed in the check.</p>
</div>
</div>
<div id="further-resources" class="section level2" number="6.9">
<h2><span class="header-section-number">6.9</span> Further resources</h2>
<ul>
<li>Hadley Wickham’s <a href="http://r-pkgs.had.co.nz/">R Packages</a> is an excellent, FREE resource on package development.</li>
<li><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a> is the canonical, usually most up-to-date, reference for creating R packages.</li>
<li>The <a href="https://github.com/MangoTheCat/goodpractice">goodpractice package</a> provides a great benchmark to compare your package to.</li>
<li>A great introduction to <code>roxygen2</code> is available <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd.html">online</a>.</li>
<li><a href="https://ropensci.org/">rOpenSci</a> provides thorough <a href="https://ropensci.github.io/dev_guide/">instructions</a> for how to create and validate your package through them.</li>
</ul>
</div>
<div id="survey-4" class="section level2" number="6.10">
<h2><span class="header-section-number">6.10</span> Survey</h2>
<p>Please provide us with feedback through this <a href="https://ubc.ca1.qualtrics.com/jfe/form/SV_2tOcP5OKnCNyauV">short survey</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-models-in-r-1.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ecoscope_datascience_workshops.pdf", "ecoscope_datascience_workshops.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
